<!DOCTYPE html>
<html>
<head>
    

    

    



    <meta charset="utf-8">
    
    
    
    <title>Mongoose入门 | YongMaple | 我不生产代码，我只是代码的搬运工</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#3F51B5">
    
    
    <meta name="keywords" content="mongodb,mongoose">
    <meta name="description" content="准备工作安装Node.js和MongoDB安装Node.js，地址：https://nodejs.org/安装MongoDB，地址：https://www.mongodb.com/    
启动MongoDBcd到mongodb下的bin文件夹，执行./mongod即可，但是我们执行后会出如下错误这里提示我们没有/data/db文件夹，需要我们自己来新建，这里我在mongodb-3.4.0下新建了">
<meta property="og:type" content="article">
<meta property="og:title" content="Mongoose入门">
<meta property="og:url" content="http://YongMaple.github.io/2017/02/07/Mongoose入门/index.html">
<meta property="og:site_name" content="YongMaple">
<meta property="og:description" content="准备工作安装Node.js和MongoDB安装Node.js，地址：https://nodejs.org/安装MongoDB，地址：https://www.mongodb.com/    
启动MongoDBcd到mongodb下的bin文件夹，执行./mongod即可，但是我们执行后会出如下错误这里提示我们没有/data/db文件夹，需要我们自己来新建，这里我在mongodb-3.4.0下新建了">
<meta property="og:image" content="http://okmneu7zl.bkt.clouddn.com/WX20170131-131657.png">
<meta property="og:image" content="http://okmneu7zl.bkt.clouddn.com/WX20170131-133558@2x.png">
<meta property="og:image" content="http://okmneu7zl.bkt.clouddn.com/WX20170131-134433.png">
<meta property="og:image" content="http://okmneu7zl.bkt.clouddn.com/WX20170131-134649.png">
<meta property="og:image" content="http://okmneu7zl.bkt.clouddn.com/WX20170131-135808.png">
<meta property="og:image" content="http://okmneu7zl.bkt.clouddn.com/WX20170131-142334.png">
<meta property="og:updated_time" content="2017-02-07T09:20:10.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Mongoose入门">
<meta name="twitter:description" content="准备工作安装Node.js和MongoDB安装Node.js，地址：https://nodejs.org/安装MongoDB，地址：https://www.mongodb.com/    
启动MongoDBcd到mongodb下的bin文件夹，执行./mongod即可，但是我们执行后会出如下错误这里提示我们没有/data/db文件夹，需要我们自己来新建，这里我在mongodb-3.4.0下新建了">
<meta name="twitter:image" content="http://okmneu7zl.bkt.clouddn.com/WX20170131-131657.png">
    
        <link rel="alternative" href="/atom.xml" title="YongMaple" type="application/atom+xml">
    
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="stylesheet" href="/css/style.css?v=1.4.6">
    <script>window.lazyScripts=[]</script>
</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.png">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">YongMaple</h5>
          <a href="mailto:740534248@qq.com" title="740534248@qq.com" class="mail">740534248@qq.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                主页
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                文章
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                标签
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                分类
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://github.com/YongMaple" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="http://weibo.com/hiimj" target="_blank" >
                <i class="icon icon-lg icon-weibo"></i>
                微博
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">Mongoose入门</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="输入感兴趣的关键字">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">Mongoose入门</h1>
        <h5 class="subtitle">
            
                <time datetime="2017-02-07T09:05:05.000Z" itemprop="datePublished" class="page-time">
  2017-02-07
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Mongoose/">Mongoose</a></li></ul>

            
        </h5>
    </div>

    

</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap" id="post-toc">
            <h4>TOC</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#准备工作"><span class="post-toc-number">1.</span> <span class="post-toc-text">准备工作</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#安装Node-js和MongoDB"><span class="post-toc-number">1.1.</span> <span class="post-toc-text">安装Node.js和MongoDB</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#启动MongoDB"><span class="post-toc-number">1.2.</span> <span class="post-toc-text">启动MongoDB</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#MongoDB基础命令"><span class="post-toc-number">1.3.</span> <span class="post-toc-text">MongoDB基础命令</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#mongoose的安装"><span class="post-toc-number">1.4.</span> <span class="post-toc-text">mongoose的安装</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#通过mongoose连接数据库"><span class="post-toc-number">1.5.</span> <span class="post-toc-text">通过mongoose连接数据库</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#Mongoose入门"><span class="post-toc-number">2.</span> <span class="post-toc-text">Mongoose入门</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#创建类Class的方式"><span class="post-toc-number">2.1.</span> <span class="post-toc-text">创建类Class的方式</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#指定对象的属性类型"><span class="post-toc-number">2.2.</span> <span class="post-toc-text">指定对象的属性类型</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#自定义类型"><span class="post-toc-number">2.3.</span> <span class="post-toc-text">自定义类型</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#所有类型都具有的配置"><span class="post-toc-number">2.4.</span> <span class="post-toc-text">所有类型都具有的配置</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#对属性的验证和转换"><span class="post-toc-number">2.5.</span> <span class="post-toc-text">对属性的验证和转换</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#自定义验证器"><span class="post-toc-number">2.6.</span> <span class="post-toc-text">自定义验证器</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#获取错误信息"><span class="post-toc-number">2.7.</span> <span class="post-toc-text">获取错误信息</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#错误信息"><span class="post-toc-number">2.8.</span> <span class="post-toc-text">错误信息</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#加入方法"><span class="post-toc-number">2.9.</span> <span class="post-toc-text">加入方法</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#对象的增删改"><span class="post-toc-number">2.10.</span> <span class="post-toc-text">对象的增删改</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#字段更改参数"><span class="post-toc-number">2.11.</span> <span class="post-toc-text">字段更改参数</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#数组类型字段的更改参数"><span class="post-toc-number">2.12.</span> <span class="post-toc-text">数组类型字段的更改参数</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#对象的基础查询"><span class="post-toc-number">2.13.</span> <span class="post-toc-text">对象的基础查询</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#比较式查询"><span class="post-toc-number">2.14.</span> <span class="post-toc-text">比较式查询</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#逻辑式查询"><span class="post-toc-number">2.15.</span> <span class="post-toc-text">逻辑式查询</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#数组专用查询"><span class="post-toc-number">2.16.</span> <span class="post-toc-text">数组专用查询</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Query查询风格"><span class="post-toc-number">2.17.</span> <span class="post-toc-text">Query查询风格</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#中间件"><span class="post-toc-number">2.18.</span> <span class="post-toc-text">中间件</span></a></li></ol></li></ol>
        </nav>
    </aside>
    
<article id="post-Mongoose入门"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">Mongoose入门</h1>
        <div class="post-meta">
            <time class="post-time" title="2017年02月07日 17:05" datetime="2017-02-07T09:05:05.000Z"  itemprop="datePublished">2017-02-07</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Mongoose/">Mongoose</a></li></ul>



            

            

        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <h2 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h2><h3 id="安装Node-js和MongoDB"><a href="#安装Node-js和MongoDB" class="headerlink" title="安装Node.js和MongoDB"></a>安装Node.js和MongoDB</h3><p>安装Node.js，地址：<a href="https://nodejs.org/" target="_blank" rel="external">https://nodejs.org/</a><br>安装MongoDB，地址：<a href="https://www.mongodb.com/download-center?jmp=nav#community" target="_blank" rel="external">https://www.mongodb.com/</a>    </p>
<h3 id="启动MongoDB"><a href="#启动MongoDB" class="headerlink" title="启动MongoDB"></a>启动MongoDB</h3><p>cd到mongodb下的bin文件夹，执行<code>./mongod</code>即可，但是我们执行后会出如下错误<br><img src="http://okmneu7zl.bkt.clouddn.com/WX20170131-131657.png" alt=""><br>这里提示我们没有/data/db文件夹，需要我们自己来新建，这里我在mongodb-3.4.0下新建了mydata文件夹，并通过<code>./mongod --dbpath ../mydata</code>启动了MongoDB，<code>--datapath</code>是用来指定路径的<br><img src="http://okmneu7zl.bkt.clouddn.com/WX20170131-133558@2x.png" alt=""><br>那么让我们来体验一下mongodb吧，首先要新建一个tab，然后同样cd到bin目录下，执行<code>./mongo</code><br><img src="http://okmneu7zl.bkt.clouddn.com/WX20170131-134433.png" alt=""><br>然后我们切回之前的tab可以看到有一个新的连接<br><img src="http://okmneu7zl.bkt.clouddn.com/WX20170131-134649.png" alt="">   </p>
<h3 id="MongoDB基础命令"><a href="#MongoDB基础命令" class="headerlink" title="MongoDB基础命令"></a>MongoDB基础命令</h3><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="http://okmneu7zl.bkt.clouddn.com/WX20170131-135808.png" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>   
<p>因为我们后期基本不会在shell里来操作，所有这里只讲几个基本的，下面的test可以随意命名，是集合名   </p>
<ul>
<li><code>db.test.insert()</code>在集合中插入一条数据   </li>
<li><code>db.test.find()</code>查找集合中所有的，可以加入参数，如<code>db.test.find({name:&quot;Jimmy&quot;})</code>  </li>
<li><code>db.test.remove({})</code>删除集合中所有元素，<code>{}</code>必须写   </li>
<li><code>show collections</code>查看所有集合   </li>
</ul>
<h3 id="mongoose的安装"><a href="#mongoose的安装" class="headerlink" title="mongoose的安装"></a>mongoose的安装</h3><p>新建一个文件夹，通过<code>npm init</code>初始化，通过<code>npm install mongoose --save</code>安装mongoose<br><img src="http://okmneu7zl.bkt.clouddn.com/WX20170131-142334.png" alt="">   </p>
<h3 id="通过mongoose连接数据库"><a href="#通过mongoose连接数据库" class="headerlink" title="通过mongoose连接数据库"></a>通过mongoose连接数据库</h3><p>新建一个js文件，复制以下代码并在shell运行<code>node xxx.js</code>，xxx为你的文件名<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> mongoose = <span class="built_in">require</span>(<span class="string">"mongoose"</span>);</div><div class="line">mongoose.connect(<span class="string">"mongodb://localhost/test"</span>)</div></pre></td></tr></table></figure></p>
<p>运行之后在之前的mongod的tab中看到有了一个新的连接   </p>
<h2 id="Mongoose入门"><a href="#Mongoose入门" class="headerlink" title="Mongoose入门"></a>Mongoose入门</h2><h3 id="创建类Class的方式"><a href="#创建类Class的方式" class="headerlink" title="创建类Class的方式"></a>创建类Class的方式</h3><p><code>var User = mongoose.model(&quot;User&quot;,userSchema)</code>   </p>
<blockquote>
<p><code>&quot;User&quot;</code>表示类名，在数据库中集合名会自动转化为小写加s<code>users</code>    </p>
<p><code>userSchema</code>定义了对象的原型   ·</p>
</blockquote>
<p><strong><em>举个栗子</em></strong><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> mongoose = <span class="built_in">require</span>(<span class="string">"mongoose"</span>);</div><div class="line">mongoose.connect(<span class="string">"mongodb://localhost/test"</span>)</div><div class="line"></div><div class="line">userSchema = <span class="keyword">new</span> mongoose.Schema(&#123;  <span class="comment">//如果只需要指定类型的话可以直接写，如果需要其他条件，需要写成对象的形式</span></div><div class="line">    name:<span class="built_in">String</span>,</div><div class="line">    <span class="attr">qq</span>:&#123;</div><div class="line">        <span class="attr">type</span>:<span class="built_in">String</span>,</div><div class="line">        <span class="attr">default</span>:<span class="string">"740534248"</span> <span class="comment">//默认</span></div><div class="line">    &#125;</div><div class="line">&#125;);</div><div class="line"><span class="keyword">const</span> User = mongoose.model(<span class="string">"User"</span>,userSchema)</div><div class="line"></div><div class="line"><span class="keyword">const</span> user = <span class="keyword">new</span> User(&#123;</div><div class="line">    <span class="attr">name</span>:<span class="string">"YongMaple"</span></div><div class="line">&#125;)</div><div class="line">user.save()</div></pre></td></tr></table></figure></p>
<h3 id="指定对象的属性类型"><a href="#指定对象的属性类型" class="headerlink" title="指定对象的属性类型"></a>指定对象的属性类型</h3><ul>
<li><p>javascript内置类型</p>
<ul>
<li>String</li>
<li>Number</li>
<li>Boolean</li>
<li>Date</li>
<li>Array   </li>
</ul>
</li>
<li><p>node.js内置类型</p>
<ul>
<li>Buffer</li>
</ul>
</li>
<li><p>mongoose特有类型</p>
<ul>
<li>Mixed</li>
<li>ObjectId</li>
</ul>
</li>
</ul>
<p><strong><em>举个栗子</em></strong><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> mongoose  = <span class="built_in">require</span>(<span class="string">"mongoose"</span>)</div><div class="line">mongoose.connect(<span class="string">"mongodb://localhost/test"</span>)</div><div class="line"></div><div class="line"><span class="keyword">const</span> ObjSchema = <span class="keyword">new</span> mongoose.Schema(&#123;</div><div class="line">    <span class="attr">str</span> : <span class="built_in">String</span>,</div><div class="line">    <span class="attr">num</span> : <span class="built_in">Number</span>,</div><div class="line">    <span class="attr">bool</span> : <span class="built_in">Boolean</span>,</div><div class="line">    <span class="attr">arr</span> : <span class="built_in">Array</span>,    <span class="comment">//[]</span></div><div class="line">    arr2 : [<span class="built_in">Date</span>],</div><div class="line">    <span class="attr">arr3</span> : [<span class="built_in">String</span>],</div><div class="line">    <span class="attr">time</span> : <span class="built_in">Date</span>,</div><div class="line"></div><div class="line">    <span class="attr">buf</span> : Buffer,</div><div class="line"></div><div class="line">    <span class="attr">mxo</span> : mongoose.Schema.Types.Mixed,  <span class="comment">//&#123;&#125;    混合数据类型</span></div><div class="line">    oid : mongoose.Schema.Types.ObjectId    <span class="comment">//唯一的</span></div><div class="line">&#125;)</div><div class="line"><span class="keyword">const</span> obj = mongoose.model(<span class="string">"obj"</span>,ObjSchema)</div><div class="line"><span class="keyword">const</span> o = <span class="keyword">new</span> obj(&#123;</div><div class="line">    <span class="attr">time</span> : <span class="keyword">new</span> <span class="built_in">Date</span>( <span class="number">42342342344</span>),  <span class="comment">//内部自动转化为Date类型，转化失败将报错</span></div><div class="line">    arr3 : [<span class="number">1234</span>,<span class="string">"jimmy"</span>,<span class="keyword">new</span> <span class="built_in">Date</span>],     <span class="comment">//内部自动转化 String</span></div><div class="line">    buf : <span class="keyword">new</span> Buffer([<span class="number">22</span>,<span class="number">33</span>,<span class="number">44</span>]),</div><div class="line"></div><div class="line">    <span class="attr">oid</span> : mongoose.Types.ObjectId()</div><div class="line">&#125;)</div><div class="line"></div><div class="line">o.save(<span class="function"><span class="keyword">function</span>(<span class="params">err</span>)</span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(err);</div><div class="line">&#125;)</div></pre></td></tr></table></figure></p>
<h3 id="自定义类型"><a href="#自定义类型" class="headerlink" title="自定义类型"></a>自定义类型</h3><p>使用自定义类型，需要：</p>
<ul>
<li>继承mongoose.SchemaType(key,options,typeName)</li>
<li>重写cast(value)方法</li>
<li>加入mongoose.Schema.Types</li>
</ul>
<p><strong><em>举个栗子</em></strong><br>创建User.js文件<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> mongoose = <span class="built_in">require</span>(<span class="string">"mongoose"</span>)</div><div class="line"></div><div class="line"><span class="comment">//es5版</span></div><div class="line"><span class="comment">// function User(key,options)&#123;</span></div><div class="line"><span class="comment">//     mongoose.SchemaType.call(this,key,options,"User")</span></div><div class="line"><span class="comment">// &#125;</span></div><div class="line"><span class="comment">//</span></div><div class="line"><span class="comment">// User.prototype = Object.create(mongoose.SchemaType.prototype)</span></div><div class="line"><span class="comment">//</span></div><div class="line"><span class="comment">// User.prototype.cast = function(val)&#123;</span></div><div class="line"><span class="comment">//     if(val.loginname &amp;&amp; val.password &amp;&amp; val.loginname.length &gt; 3)&#123;</span></div><div class="line"><span class="comment">//         return &#123;</span></div><div class="line"><span class="comment">//             loginname : val.loginname,</span></div><div class="line"><span class="comment">//             password : val.password</span></div><div class="line"><span class="comment">//         &#125;</span></div><div class="line"><span class="comment">//     &#125;else&#123;</span></div><div class="line"><span class="comment">//         throw new Error("user has error!")</span></div><div class="line"><span class="comment">//     &#125;</span></div><div class="line"><span class="comment">// &#125;</span></div><div class="line"><span class="comment">//</span></div><div class="line"><span class="comment">// mongoose.Schema.Types.User = User;</span></div><div class="line"><span class="comment">//</span></div><div class="line"><span class="comment">// module.exports = User;</span></div><div class="line"></div><div class="line"><span class="comment">//es6版</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">extends</span> <span class="title">mongoose</span>.<span class="title">SchemaType</span></span>&#123;</div><div class="line">    <span class="keyword">constructor</span>(key,opts)&#123;</div><div class="line">        <span class="keyword">super</span>(key,opts,<span class="string">"User"</span>)</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    cast(val)&#123;</div><div class="line">        <span class="keyword">if</span>(val.loginname &amp;&amp; val.password &amp;&amp; val.loginname.length &gt; <span class="number">3</span>)&#123;</div><div class="line">            <span class="keyword">return</span> &#123;</div><div class="line">                <span class="attr">loginname</span> : val.loginname,</div><div class="line">                <span class="attr">password</span> : val.password</div><div class="line">            &#125;</div><div class="line">        &#125;<span class="keyword">else</span>&#123;</div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"user has error!"</span>)</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>再创建一个demo.js文件来使用上面的User.js<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> mongoose = <span class="built_in">require</span>(<span class="string">"mongoose"</span>)</div><div class="line"></div><div class="line">mongoose.connect(<span class="string">"mongodb://localhost/test"</span>)</div><div class="line"></div><div class="line"><span class="keyword">const</span> User = <span class="built_in">require</span>(<span class="string">"./User"</span>)</div><div class="line"></div><div class="line"><span class="keyword">const</span> People = mongoose.model(<span class="string">"People"</span>,<span class="keyword">new</span> mongoose.Schema(&#123;</div><div class="line">    <span class="attr">user</span>:User</div><div class="line">&#125;))</div><div class="line"></div><div class="line"><span class="keyword">const</span> o = <span class="keyword">new</span> People(&#123;</div><div class="line">    <span class="attr">user</span>:&#123;</div><div class="line">        <span class="attr">loginname</span>:<span class="string">"jimmy"</span>,</div><div class="line">        <span class="attr">password</span>:<span class="string">"123456"</span></div><div class="line">    &#125;</div><div class="line">&#125;)</div><div class="line"></div><div class="line">o.save(<span class="function"><span class="keyword">function</span> <span class="title">callback</span>(<span class="params">err,result</span>)</span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(err);</div><div class="line">&#125;)</div></pre></td></tr></table></figure></p>
<h3 id="所有类型都具有的配置"><a href="#所有类型都具有的配置" class="headerlink" title="所有类型都具有的配置"></a>所有类型都具有的配置</h3><ul>
<li>强制不得为空（验证器）   <ul>
<li>required:true</li>
</ul>
</li>
<li>设置属性默认值   <ul>
<li>default:”qq740534248”</li>
</ul>
</li>
<li>是否包括在查询结果中   <ul>
<li>select:false</li>
</ul>
</li>
<li>getter 和 setter 拦截器   <ul>
<li>get:v =&gt; v   </li>
<li>set:v =&gt; v   </li>
</ul>
</li>
</ul>
<p><strong><em>举个栗子</em></strong><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> mongoose = <span class="built_in">require</span>(<span class="string">"mongoose"</span>)</div><div class="line"></div><div class="line">mongoose.connect(<span class="string">"mongodb://localhost/test"</span>)</div><div class="line"></div><div class="line"><span class="keyword">const</span> Obj = mongoose.model(<span class="string">"Obj"</span>,<span class="keyword">new</span> mongoose.Schema(&#123;</div><div class="line">    <span class="attr">str</span>:&#123;</div><div class="line">        <span class="attr">type</span>:<span class="built_in">String</span>,</div><div class="line">        <span class="attr">default</span>:<span class="string">"YongMaple"</span>,</div><div class="line">        get(v)&#123;</div><div class="line">            <span class="keyword">return</span> <span class="string">`my name is <span class="subst">$&#123;v&#125;</span>`</span></div><div class="line">        &#125;,</div><div class="line">        set(v)&#123;</div><div class="line">            <span class="keyword">return</span> <span class="number">123</span>+v</div><div class="line">        &#125;</div><div class="line">    &#125;,</div><div class="line"></div><div class="line">    <span class="attr">loginname</span>:&#123;</div><div class="line">        <span class="attr">type</span>:<span class="built_in">String</span>,</div><div class="line">        <span class="attr">required</span>:<span class="literal">true</span></div><div class="line">    &#125;,</div><div class="line"></div><div class="line">    <span class="attr">str2</span>:&#123;</div><div class="line">        <span class="attr">type</span>:<span class="built_in">String</span>,</div><div class="line">        <span class="attr">select</span>:<span class="literal">false</span></div><div class="line">    &#125;</div><div class="line">&#125;))</div><div class="line"></div><div class="line"><span class="keyword">const</span> o = <span class="keyword">new</span> Obj(&#123;</div><div class="line">    <span class="attr">str</span>:<span class="string">"Jimmy"</span>,</div><div class="line">    <span class="attr">str2</span>:<span class="string">"111111"</span>,</div><div class="line">    <span class="attr">loginname</span>:<span class="string">"333333"</span></div><div class="line">&#125;)</div><div class="line"><span class="built_in">console</span>.log(o.str);     <span class="comment">//my name is 123Jimmy</span></div><div class="line"></div><div class="line">o.save(<span class="function"><span class="keyword">function</span>(<span class="params">err</span>)</span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(err);</div><div class="line">    Obj.findOne(&#123;&#125;,<span class="function"><span class="keyword">function</span>(<span class="params">err,result</span>)</span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(result);    <span class="comment">//&#123; _id: 58993a84a184201ce8ebf5f5, __v: 0, str: '123Jimmy' &#125;</span></div><div class="line">    &#125;)</div><div class="line">&#125;)</div></pre></td></tr></table></figure></p>
<h3 id="对属性的验证和转换"><a href="#对属性的验证和转换" class="headerlink" title="对属性的验证和转换"></a>对属性的验证和转换</h3><p><strong>验证</strong></p>
<ul>
<li>枚举<ul>
<li>enum:Array</li>
</ul>
</li>
<li>正则表达式验证<ul>
<li>match</li>
</ul>
</li>
<li>限制字符串最大和最小长度<ul>
<li>maxlength &amp; minlength   </li>
</ul>
</li>
<li>Number和Date的最大最小值<ul>
<li>max &amp; min   </li>
</ul>
</li>
</ul>
<p><strong>转换</strong></p>
<ul>
<li>字母大小写转化<ul>
<li>lowercase &amp; uppercase</li>
</ul>
</li>
<li>去除字符串前后空白字符<ul>
<li>trim:true/false</li>
</ul>
</li>
</ul>
<p><strong><em>举个栗子</em></strong><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> mongoose =<span class="built_in">require</span>(<span class="string">"mongoose"</span>)</div><div class="line"></div><div class="line">mongoose.connect(<span class="string">"mongodb://localhost/test"</span>)</div><div class="line"></div><div class="line"><span class="keyword">const</span> baseDateNum = <span class="built_in">Date</span>.now()</div><div class="line"></div><div class="line"><span class="keyword">const</span> Obj = mongoose.model(<span class="string">"Obj"</span>,<span class="keyword">new</span> mongoose.Schema(&#123;</div><div class="line"></div><div class="line">    <span class="attr">str</span>:&#123;</div><div class="line">        <span class="attr">type</span>:<span class="built_in">String</span>,</div><div class="line">        <span class="attr">enum</span>:[<span class="string">"aaa"</span>,<span class="string">"bbb"</span>]</div><div class="line">    &#125;,</div><div class="line"></div><div class="line">    <span class="attr">qq</span>:&#123;</div><div class="line">        <span class="attr">type</span>:<span class="built_in">String</span>,</div><div class="line">        <span class="attr">match</span>:<span class="regexp">/^\d*$/</span>,</div><div class="line">        <span class="attr">maxlength</span>:<span class="number">20</span>,</div><div class="line">        <span class="attr">minlength</span>:<span class="number">5</span></div><div class="line">    &#125;,</div><div class="line"></div><div class="line">    <span class="attr">lowerstr</span>:&#123;</div><div class="line">        <span class="attr">type</span>:<span class="built_in">String</span>,</div><div class="line">        <span class="attr">lowercase</span>:<span class="literal">true</span></div><div class="line">    &#125;,</div><div class="line">    <span class="attr">upperstr</span>:&#123;</div><div class="line">        <span class="attr">type</span>:<span class="built_in">String</span>,</div><div class="line">        <span class="attr">uppercase</span>:<span class="literal">true</span></div><div class="line">    &#125;,</div><div class="line">    <span class="attr">trimstr</span>:&#123;</div><div class="line">        <span class="attr">type</span>:<span class="built_in">String</span>,</div><div class="line">        <span class="attr">trim</span>:<span class="literal">true</span></div><div class="line">    &#125;,</div><div class="line">    <span class="attr">num</span>:&#123;</div><div class="line">        <span class="attr">type</span>:<span class="built_in">Number</span>,</div><div class="line">        <span class="attr">min</span>:<span class="number">6</span>,</div><div class="line">        <span class="attr">max</span>:<span class="number">20</span></div><div class="line">    &#125;,</div><div class="line">    <span class="attr">date</span>:&#123;</div><div class="line">        <span class="attr">type</span>:<span class="built_in">Date</span>,</div><div class="line">        <span class="attr">min</span>:<span class="keyword">new</span> <span class="built_in">Date</span>(baseDateNum - <span class="number">1000</span>),</div><div class="line">        <span class="attr">max</span>:<span class="keyword">new</span> <span class="built_in">Date</span>(baseDateNum + <span class="number">2000</span>)</div><div class="line">    &#125;</div><div class="line">&#125;))</div><div class="line"></div><div class="line"><span class="keyword">const</span> o = <span class="keyword">new</span> Obj(&#123;</div><div class="line">    <span class="attr">str</span>:<span class="string">"bbb"</span>,</div><div class="line">    <span class="attr">qq</span>:<span class="string">"740534248"</span>,</div><div class="line">    <span class="attr">lowerstr</span>:<span class="string">"aaaAAAA"</span>,</div><div class="line">    <span class="attr">upperstr</span>:<span class="string">"bbbBBBB"</span>,</div><div class="line">    <span class="attr">trimstr</span>:<span class="string">"    aaa  aaff"</span>,</div><div class="line">    <span class="attr">num</span>:<span class="number">6</span>,</div><div class="line">    <span class="attr">date</span>:<span class="keyword">new</span> <span class="built_in">Date</span>(baseDateNum+<span class="number">1000</span>)</div><div class="line">&#125;)</div><div class="line"><span class="built_in">console</span>.log(o);</div><div class="line"><span class="keyword">const</span> err = o.validateSync()    <span class="comment">//同步校验，后面会讲</span></div><div class="line"></div><div class="line"><span class="built_in">console</span>.log(err);</div></pre></td></tr></table></figure></p>
<h3 id="自定义验证器"><a href="#自定义验证器" class="headerlink" title="自定义验证器"></a>自定义验证器</h3><p>有三种方式来自定义验证器</p>
<ul>
<li>validate:{ validator:Function }</li>
<li>Class.schema.path(xxx).validate(fn)    //xxx 表示要获取的属性名，然后对其验证</li>
<li>validator(v,[callback])同步验证器，加入第二个参数callback变为异步验证器<br><strong><em>举个栗子</em></strong>   <figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> mongoose = <span class="built_in">require</span>(<span class="string">"mongoose"</span>)</div><div class="line"></div><div class="line">mongoose.connect(<span class="string">"mongodb://localhost/test"</span>)</div><div class="line"></div><div class="line"><span class="keyword">const</span> User = mongoose.model(<span class="string">"User"</span>,<span class="keyword">new</span> mongoose.Schema(&#123;</div><div class="line">    <span class="attr">name</span>:&#123;</div><div class="line">        <span class="attr">type</span>:<span class="built_in">String</span>,</div><div class="line">        <span class="comment">// validate:&#123;   //同步验证器，也可以是数组形式，同时多个验证器</span></div><div class="line">        <span class="comment">//     validator(value)&#123;</span></div><div class="line">        <span class="comment">//         return value.length &lt;= 9</span></div><div class="line">        <span class="comment">//     &#125;</span></div><div class="line">        <span class="comment">// &#125;</span></div><div class="line">    &#125;</div><div class="line">&#125;))</div><div class="line"></div><div class="line">User.schema.path(<span class="string">"name"</span>).validate(<span class="function"><span class="keyword">function</span>(<span class="params">v</span>)</span>&#123;</div><div class="line">    <span class="keyword">return</span> v.length &lt;= <span class="number">9</span></div><div class="line">&#125;)</div><div class="line">User.schema.path(<span class="string">"name"</span>).validate(<span class="function"><span class="keyword">function</span>(<span class="params">v</span>)</span>&#123;  <span class="comment">//可以加入多个</span></div><div class="line">    <span class="keyword">return</span> v.length &gt; <span class="number">3</span></div><div class="line">&#125;)</div><div class="line"><span class="keyword">const</span> u = <span class="keyword">new</span> User(&#123;</div><div class="line">    <span class="attr">name</span>:<span class="string">"1234"</span></div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="keyword">const</span> err = u.validateSync()</div><div class="line"><span class="built_in">console</span>.log(err);</div></pre></td></tr></table></figure>
</li>
</ul>
<p><strong><em>再举个异步的栗子</em></strong><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> mongoose = <span class="built_in">require</span>(<span class="string">"mongoose"</span>)</div><div class="line"></div><div class="line">mongoose.connect(<span class="string">"mongodb://localhost/test"</span>)</div><div class="line"></div><div class="line"><span class="keyword">const</span> User = mongoose.model(<span class="string">"User"</span>,<span class="keyword">new</span> mongoose.Schema(&#123;</div><div class="line">    <span class="attr">loginname</span>:&#123;</div><div class="line">        <span class="attr">type</span>:<span class="built_in">String</span>,</div><div class="line">        <span class="attr">validate</span>:&#123;</div><div class="line">            validator(value,cb)&#123;</div><div class="line">                User.findOne(&#123;<span class="attr">loginname</span>:value&#125;,<span class="function"><span class="keyword">function</span>(<span class="params">err,result</span>)</span>&#123;</div><div class="line">                    cb(!result)</div><div class="line">                &#125;)</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;))</div><div class="line"></div><div class="line"><span class="keyword">var</span> user = <span class="keyword">new</span> User(&#123;</div><div class="line">    <span class="attr">loginname</span>:<span class="string">"hahahaha"</span></div><div class="line">&#125;)</div><div class="line">user.save(<span class="function"><span class="keyword">function</span>(<span class="params">err</span>)</span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(err);   <span class="comment">//运行2遍，第二遍会抛出异常</span></div><div class="line">&#125;)</div></pre></td></tr></table></figure></p>
<h3 id="获取错误信息"><a href="#获取错误信息" class="headerlink" title="获取错误信息"></a>获取错误信息</h3><ul>
<li>doc.validate( error =&gt; error )    <strong><em>异步获得错误信息</em></strong></li>
<li>error = doc.validateSync()        <strong><em>获取同步错误信息</em></strong></li>
<li>doc.save( error =&gt; error )        <strong><em>回调获得错误信息</em></strong></li>
<li>promise = doc.save()              <strong><em>promise方式获得错误信息</em></strong></li>
<li>Class.update( query , update , { runValidators:true } , callback)<br><strong><em>举个栗子</em></strong>   <figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> mongoose = <span class="built_in">require</span>(<span class="string">"mongoose"</span>)</div><div class="line"></div><div class="line">mongoose.connect(<span class="string">"mongodb://localhost/test"</span>)</div><div class="line"></div><div class="line"><span class="keyword">const</span> User = mongoose.model(<span class="string">"User"</span>,<span class="keyword">new</span> mongoose.Schema(&#123;</div><div class="line">    <span class="attr">loginname</span>:&#123;</div><div class="line">        <span class="attr">type</span>:<span class="built_in">String</span>,</div><div class="line">        <span class="attr">required</span>:<span class="literal">true</span>,</div><div class="line">        <span class="attr">validate</span>:&#123;</div><div class="line">            validator(value,cb)&#123;</div><div class="line">                setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">                    cb(<span class="literal">false</span>)</div><div class="line">                &#125;)</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;))</div><div class="line"></div><div class="line"><span class="keyword">const</span> u = <span class="keyword">new</span> User(&#123;</div><div class="line">    <span class="attr">loginname</span>:<span class="string">"aaa11"</span></div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="comment">//1 只能获得同步</span></div><div class="line"><span class="keyword">const</span> err = u.validateSync()</div><div class="line"><span class="built_in">console</span>.log(err);</div><div class="line"></div><div class="line"><span class="comment">// 2 同步异步都能</span></div><div class="line"><span class="comment">// u.validate(function(err)&#123;</span></div><div class="line"><span class="comment">//     console.log(err);</span></div><div class="line"><span class="comment">// &#125;)</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">//3 同步异步都能  有可能是底层传上来的错误</span></div><div class="line"><span class="comment">// u.save(function(err)&#123;</span></div><div class="line"><span class="comment">//     console.log(err);</span></div><div class="line"><span class="comment">// &#125;)</span></div><div class="line"></div><div class="line"><span class="comment">//4 同步异步都能  有可能是底层传上来的错误</span></div><div class="line"><span class="comment">// const promise = u.save()</span></div><div class="line"><span class="comment">// promise.catch(err =&gt; console.log(err))</span></div><div class="line"></div><div class="line"><span class="comment">//5 同步异步都能  有可能是底层传上来的错误</span></div><div class="line"><span class="comment">// User.update(&#123;&#125;,&#123;loginname:"123aaa"&#125;,&#123;runValidators:true&#125;,function(err)&#123;</span></div><div class="line"><span class="comment">//     console.log(err);</span></div><div class="line"><span class="comment">// &#125;)</span></div></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="错误信息"><a href="#错误信息" class="headerlink" title="错误信息"></a>错误信息</h3><ul>
<li>err.errors    <strong><em>错误集合</em></strong></li>
<li>err.errors.qq   <strong><em>得到qq属性值的错误信息</em></strong></li>
<li>{ path , value , message } = err.errors.qq<br><strong><em>举个栗子</em></strong>   <figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> mongoose = <span class="built_in">require</span>(<span class="string">"mongoose"</span>)</div><div class="line"></div><div class="line">mongoose.connect(<span class="string">"mongodb://localhost/test"</span>)</div><div class="line"></div><div class="line"><span class="keyword">const</span> User = mongoose.model(<span class="string">"User"</span>,<span class="keyword">new</span> mongoose.Schema(&#123;</div><div class="line">    <span class="attr">loginname</span>:&#123;</div><div class="line">        <span class="attr">type</span>:<span class="built_in">String</span>,</div><div class="line">        <span class="attr">required</span>:[<span class="literal">true</span>,<span class="string">"必须输入 &#123;PATH&#125; - &#123;VALUE&#125;"</span>], <span class="comment">//除了enum以外所有内置验证器都是这样写</span></div><div class="line">        enum:&#123;<span class="attr">values</span>:[<span class="string">"aaa"</span>,<span class="string">"bbb"</span>],<span class="attr">message</span>:<span class="string">"没在枚举中。。。 &#123;PATH&#125; - &#123;VALUE&#125;"</span>&#125;,     <span class="comment">//枚举时，自定义错误信息比较特殊，是对象形式</span></div><div class="line">        validate:&#123;      <span class="comment">//自定义校验器要这样写，也是对象</span></div><div class="line">            validator(value,cb)&#123;</div><div class="line">                setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">                    cb(<span class="literal">false</span>)   <span class="comment">//模拟异步错误</span></div><div class="line">                &#125;)</div><div class="line">            &#125;,</div><div class="line">            <span class="attr">message</span>:<span class="string">"校验错误 &#123;PATH&#125; - &#123;VALUE&#125;"</span></div><div class="line">        &#125;</div><div class="line">    &#125;,</div><div class="line">    <span class="attr">password</span>:&#123;</div><div class="line">        <span class="attr">type</span>:<span class="built_in">String</span>,</div><div class="line">        <span class="attr">required</span>:[<span class="literal">true</span>,<span class="string">"密码必须填写"</span>],</div><div class="line">        <span class="attr">minlength</span>:[<span class="number">6</span>,<span class="string">"密码至少6位"</span>]</div><div class="line">    &#125;</div><div class="line">&#125;))</div><div class="line"></div><div class="line"><span class="keyword">const</span> u = <span class="keyword">new</span> User(&#123;</div><div class="line">    <span class="attr">loginname</span>:<span class="string">"aaa11"</span></div><div class="line">&#125;)</div><div class="line"></div><div class="line">u.validate(<span class="function"><span class="keyword">function</span>(<span class="params">err</span>)</span>&#123;</div><div class="line"><span class="comment">//     const &#123;path,value,message&#125; = err.errors.loginname</span></div><div class="line"><span class="comment">//     console.log(path);</span></div><div class="line"><span class="comment">//     console.log(value);</span></div><div class="line"><span class="comment">//     console.log(message);</span></div><div class="line"></div><div class="line">    <span class="keyword">if</span>(err &amp;&amp; err.errors)&#123;</div><div class="line">        <span class="keyword">const</span> keys = <span class="built_in">Object</span>.keys(err.errors)</div><div class="line">        <span class="keyword">let</span> str = <span class="string">""</span></div><div class="line">        keys.map(<span class="function">(<span class="params">v,i</span>) =&gt;</span> &#123;</div><div class="line">            str += <span class="string">`<span class="subst">$&#123;v&#125;</span>:<span class="subst">$&#123;err.errors[v]&#125;</span>\n`</span></div><div class="line">        &#125;)</div><div class="line">        <span class="built_in">console</span>.log(str);</div><div class="line">    &#125;</div><div class="line">    <span class="comment">//....</span></div><div class="line">&#125;)</div></pre></td></tr></table></figure>
</li>
</ul>
<p>例子中<code>{PATH}</code>和<code>{VALUE}</code>是属性名和属性值</p>
<h3 id="加入方法"><a href="#加入方法" class="headerlink" title="加入方法"></a>加入方法</h3><ul>
<li>加入实例方法 schema.methods.xxx</li>
<li>加入静态方法 schema.statics.xxx</li>
<li>加入虚拟方法 getter/setter方法<ul>
<li>virtual(‘xxx’).get(handle)   </li>
<li>virtual(‘xxx’).set(handle)<br><strong><em>举个栗子</em></strong>   <figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> mongoose = <span class="built_in">require</span>(<span class="string">"mongoose"</span>)</div><div class="line">mongoose.connect(<span class="string">"mongodb://localhost/test"</span>)</div><div class="line"><span class="keyword">const</span> userSchema = <span class="keyword">new</span> mongoose.Schema(&#123;</div><div class="line">    <span class="attr">firstName</span>: <span class="built_in">String</span>,</div><div class="line">    <span class="attr">secondName</span>: <span class="built_in">String</span></div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="comment">//methods和statics的区别在于this是谁</span></div><div class="line">userSchema.methods.getAllName = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.firstName + <span class="string">'.'</span> + <span class="keyword">this</span>.secondName   <span class="comment">//这里的this指的是对象本身</span></div><div class="line">&#125;</div><div class="line"></div><div class="line">userSchema.statics.getAll = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;             <span class="comment">//可以加入回调函数  function(cb)&#123;</span></div><div class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.find(&#123;&#125;)     <span class="comment">//这里的this指的是User类   可以加入回调函数  this.find(&#123;&#125;,cb)</span></div><div class="line">&#125;</div><div class="line"></div><div class="line">userSchema.virtual(<span class="string">"allname"</span>).get(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.firstName + <span class="string">'.'</span> + <span class="keyword">this</span>.secondName</div><div class="line">&#125;)  <span class="comment">//getter method</span></div><div class="line"></div><div class="line">userSchema.virtual(<span class="string">"allname"</span>).set(<span class="function"><span class="keyword">function</span>(<span class="params">v</span>)</span>&#123;</div><div class="line">    <span class="comment">//Yong.Maple</span></div><div class="line">    <span class="keyword">const</span> names = v.split(<span class="string">"."</span>);</div><div class="line">    <span class="keyword">this</span>.firstName = names[<span class="number">0</span>];</div><div class="line">    <span class="keyword">this</span>.secondName = names[<span class="number">1</span>];</div><div class="line">&#125;);  <span class="comment">//setter method</span></div><div class="line"></div><div class="line"><span class="keyword">const</span> User = mongoose.model(<span class="string">"User"</span>,userSchema)</div><div class="line"></div><div class="line"><span class="comment">// const u = new User(&#123;</span></div><div class="line"><span class="comment">//     firstName:"Yong ",</span></div><div class="line"><span class="comment">//     secondName:"Maple"</span></div><div class="line"><span class="comment">// &#125;)</span></div><div class="line"><span class="comment">//</span></div><div class="line"><span class="comment">// console.log(u.getAllName());</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">// User.remove(&#123;&#125;).then(()=&gt;&#123;</span></div><div class="line"><span class="comment">//     User.insertMany([</span></div><div class="line"><span class="comment">//         &#123;firstName:"Yong",secondName:"Maple"&#125;,</span></div><div class="line"><span class="comment">//         &#123;firstName:"Zhang",secondName:"San"&#125;,</span></div><div class="line"><span class="comment">//         &#123;firstName:"Li",secondName:"Si"&#125;</span></div><div class="line"><span class="comment">//     ]).then(()=&gt;&#123;</span></div><div class="line"><span class="comment">//         User.getAll().then(result=&gt; console.log(result))</span></div><div class="line"><span class="comment">//     &#125;)</span></div><div class="line"><span class="comment">// &#125;)</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">const</span> user = <span class="keyword">new</span> User(&#123;</div><div class="line">    <span class="attr">allname</span>:<span class="string">"Yong.Maple"</span></div><div class="line">&#125;)</div><div class="line">user.save()</div><div class="line"><span class="built_in">console</span>.log(user);</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<h3 id="对象的增删改"><a href="#对象的增删改" class="headerlink" title="对象的增删改"></a>对象的增删改</h3><ul>
<li>obj.save / Class.create / Class.insertMany</li>
<li>obj.remove / Class.remove</li>
<li>obj.update / Class.update    </li>
</ul>
<p><strong><em>举个栗子</em></strong><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> mongoose = <span class="built_in">require</span>(<span class="string">"mongoose"</span>)</div><div class="line"></div><div class="line">mongoose.connect(<span class="string">"mongodb://localhost/test"</span>)</div><div class="line"></div><div class="line"><span class="keyword">const</span> User = mongoose.model(<span class="string">"User"</span>,&#123;</div><div class="line">    <span class="attr">name</span>:&#123;<span class="attr">type</span>:<span class="built_in">String</span>,<span class="attr">maxlength</span>:<span class="number">10</span>&#125;</div><div class="line">&#125;)</div><div class="line"></div><div class="line"></div><div class="line">User.remove(&#123;&#125;).then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="comment">// --------------save</span></div><div class="line">    <span class="comment">// const user = new User(&#123;name:"JiaYongfeng"&#125;)</span></div><div class="line">    <span class="comment">// const promise = user.save()</span></div><div class="line">    <span class="comment">// promise</span></div><div class="line">    <span class="comment">// .then(u =&gt; console.log(u))</span></div><div class="line">    <span class="comment">// .catch(err =&gt; console.log(err))</span></div><div class="line">    <span class="comment">//</span></div><div class="line">    <span class="comment">//</span></div><div class="line">    <span class="comment">// user.save(function (err,u)&#123;</span></div><div class="line">    <span class="comment">//     console.log(err,u);</span></div><div class="line">    <span class="comment">// &#125;)</span></div><div class="line"></div><div class="line">    <span class="comment">// --------------create     成功的保存，失败的抛出异常</span></div><div class="line">    <span class="comment">// User.create(&#123;name:"Jia"&#125;,&#123;name:"Yong"&#125;)</span></div><div class="line">    <span class="comment">// .then(function(u1,u2)&#123;</span></div><div class="line">    <span class="comment">//     console.log(u1,u2);</span></div><div class="line">    <span class="comment">// &#125;).catch(err =&gt; console.log(err))</span></div><div class="line"></div><div class="line">    <span class="comment">// User.create([&#123;name:"Jia"&#125;,&#123;name:"Yong1111"&#125;])</span></div><div class="line">    <span class="comment">// .then(function(arr)&#123;</span></div><div class="line">    <span class="comment">//     console.log(arr);</span></div><div class="line">    <span class="comment">// &#125;).catch(err =&gt; console.log(err))</span></div><div class="line"></div><div class="line"></div><div class="line">    <span class="comment">// ------------------insertMany     必须是数组，一条失败，全部失败</span></div><div class="line">    <span class="comment">// User.insertMany([&#123;name:"Jia"&#125;,&#123;name:"Yong"&#125;])</span></div><div class="line">    <span class="comment">// .then(function(arr)&#123;</span></div><div class="line">    <span class="comment">//     console.log(arr);</span></div><div class="line">    <span class="comment">// &#125;).catch(err =&gt; console.log(err))</span></div><div class="line"></div><div class="line"></div><div class="line">    <span class="comment">// --------------------remove</span></div><div class="line">    <span class="comment">// User.insertMany([&#123;name:"Jia22"&#125;,&#123;name:"Jia33"&#125;,&#123;name:"Jiasasd"&#125;,&#123;name:"Yong"&#125;])</span></div><div class="line">    <span class="comment">// .then(function(arr)&#123;</span></div><div class="line">    <span class="comment">//     User.remove(&#123;name:/^Jia\d*$/&#125;).then(r =&gt; console.log(r))</span></div><div class="line"></div><div class="line">        <span class="comment">// User.remove(&#123;name:"Jia"&#125;).then(r =&gt; console.log(r))</span></div><div class="line"></div><div class="line">        <span class="comment">// arr[0].remove()</span></div><div class="line">        <span class="comment">//     .then(obj =&gt; User.create(&#123;name:obj.name + " ----- reborn"&#125;))</span></div><div class="line">        <span class="comment">//     .catch(err =&gt; console.log(err))</span></div><div class="line"></div><div class="line">        <span class="comment">// arr[0].remove(function(err,obj)&#123;</span></div><div class="line">        <span class="comment">//     console.log(err,obj);</span></div><div class="line">        <span class="comment">// &#125;)</span></div><div class="line"></div><div class="line">    <span class="comment">// &#125;).catch(err =&gt; console.log(err))</span></div><div class="line"></div><div class="line"></div><div class="line">    <span class="comment">// -----------------------update</span></div><div class="line">    User.insertMany([&#123;<span class="attr">name</span>:<span class="string">"Jia22"</span>&#125;,&#123;<span class="attr">name</span>:<span class="string">"Jia33"</span>&#125;,&#123;<span class="attr">name</span>:<span class="string">"Jiasasd"</span>&#125;,&#123;<span class="attr">name</span>:<span class="string">"Yong"</span>&#125;])</div><div class="line">    .then(<span class="function"><span class="keyword">function</span>(<span class="params">arr</span>)</span>&#123;</div><div class="line"></div><div class="line">        User.update(&#123;&#125;,&#123;<span class="attr">name</span>:<span class="string">"YongFeng"</span>&#125;,&#123;<span class="attr">multi</span>:<span class="literal">true</span>&#125;,<span class="function"><span class="keyword">function</span>(<span class="params">err,result</span>)</span>&#123;      <span class="comment">//默认只修改第一个符合条件的值,需要修改多个要加&#123;multi:true&#125;</span></div><div class="line">            <span class="built_in">console</span>.log(err,result);</div><div class="line">        &#125;)</div><div class="line"></div><div class="line">        <span class="comment">// console.log("before update  ==&gt;",arr[0]);</span></div><div class="line">        <span class="comment">// arr[0].update(&#123;name:"123123123123fsdsdfddfsdfdsasdas"&#125;,&#123;runValidators:true&#125;).then(function(result)&#123;</span></div><div class="line">        <span class="comment">//     console.log(result);</span></div><div class="line">        <span class="comment">// &#125;).catch(err =&gt; console.log(err))</span></div><div class="line">    &#125;).catch(<span class="function"><span class="params">err</span> =&gt;</span> <span class="built_in">console</span>.log(err))</div><div class="line">&#125;)</div></pre></td></tr></table></figure></p>
<h3 id="字段更改参数"><a href="#字段更改参数" class="headerlink" title="字段更改参数"></a>字段更改参数</h3><ul>
<li>$inc 加法运算</li>
<li>$mul 乘法运算</li>
<li>$min / $max 数值和日期的限定</li>
<li>$currentDate 设定当前日期<br><strong><em>举个栗子</em></strong>   <figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> mongoose = <span class="built_in">require</span>(<span class="string">"mongoose"</span>)</div><div class="line"></div><div class="line">mongoose.connect(<span class="string">"mongodb://localhost/test"</span>)</div><div class="line"></div><div class="line"><span class="keyword">var</span> Topic = mongoose.model(<span class="string">"Topic"</span>, <span class="keyword">new</span> mongoose.Schema(&#123;</div><div class="line">    <span class="attr">title</span>: &#123;</div><div class="line">        <span class="attr">type</span>: <span class="built_in">String</span>,</div><div class="line">        <span class="attr">required</span>: <span class="literal">true</span></div><div class="line">    &#125;,</div><div class="line">    <span class="attr">body</span>: &#123;</div><div class="line">        <span class="attr">type</span>: <span class="built_in">String</span>,</div><div class="line">        <span class="attr">required</span>: <span class="literal">true</span></div><div class="line">    &#125;,</div><div class="line">    <span class="attr">money</span>: &#123;</div><div class="line">        <span class="attr">type</span>: <span class="built_in">Number</span>,</div><div class="line">        <span class="attr">default</span>: <span class="number">0.5</span></div><div class="line">    &#125;,</div><div class="line">    <span class="attr">accessNum</span>: &#123;</div><div class="line">        <span class="attr">type</span>: <span class="built_in">Number</span>,</div><div class="line">        <span class="attr">default</span>: <span class="number">0</span></div><div class="line">    &#125;,</div><div class="line">    <span class="attr">createTime</span>: <span class="built_in">Date</span>,</div><div class="line">    <span class="attr">updateTime</span>: <span class="built_in">Date</span></div><div class="line">&#125;))</div><div class="line"></div><div class="line">Topic.remove(&#123;&#125;, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">const</span> date = <span class="keyword">new</span> <span class="built_in">Date</span></div><div class="line">    <span class="keyword">var</span> topic = <span class="keyword">new</span> Topic(&#123;</div><div class="line">        <span class="attr">title</span>: <span class="string">"aa"</span>,</div><div class="line">        <span class="attr">body</span>: <span class="string">"content"</span>,</div><div class="line">        <span class="attr">createTime</span>: date,</div><div class="line">        <span class="attr">updateTime</span>: date</div><div class="line">    &#125;)</div><div class="line"></div><div class="line">    topic.save(<span class="function"><span class="keyword">function</span>(<span class="params">err, result</span>) </span>&#123;</div><div class="line"></div><div class="line">        Topic.update(&#123;&#125;, &#123;</div><div class="line">            <span class="attr">title</span>: <span class="string">"my js"</span>,</div><div class="line"></div><div class="line">            <span class="attr">$currentDate</span>:&#123;  <span class="comment">//使用当前时间修改updateTime的值</span></div><div class="line">                updateTime:<span class="literal">true</span></div><div class="line">            &#125;,</div><div class="line"></div><div class="line">            <span class="attr">$min</span>: &#123; <span class="comment">//最小值，和平时理解的不一样，必须小于15，不超过15变成15</span></div><div class="line">                accessNum: <span class="number">15</span>   <span class="comment">//15</span></div><div class="line">            &#125;,</div><div class="line">            <span class="comment">// $max: &#123; //最大值，和平时理解的不一样，必须大于15，不满15变成15</span></div><div class="line">            <span class="comment">//     accessNum: 15   //15</span></div><div class="line">            <span class="comment">// &#125;</span></div><div class="line"></div><div class="line">            <span class="comment">//每个参数只能在一个算法当中</span></div><div class="line">            <span class="comment">// $mul: &#123; //乘</span></div><div class="line">            <span class="comment">//     money: 3    //1.5</span></div><div class="line">            <span class="comment">// &#125;,</span></div><div class="line">            <span class="comment">// $inc: &#123; //加</span></div><div class="line">            <span class="comment">//     accessNum: 2    //2</span></div><div class="line">            <span class="comment">// &#125;</span></div><div class="line">        &#125;, <span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>&#123;</div><div class="line"></div><div class="line">        &#125;)</div><div class="line"></div><div class="line">    &#125;)</div><div class="line"></div><div class="line">&#125;)</div></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="数组类型字段的更改参数"><a href="#数组类型字段的更改参数" class="headerlink" title="数组类型字段的更改参数"></a>数组类型字段的更改参数</h3><ul>
<li>$pop 删除一条数据</li>
<li>$addToSet 添加去重数据</li>
<li>$pull / $pullAll 清除</li>
<li>$push 加入数据<br><strong><em>举个栗子</em></strong>   <figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> mongoose = <span class="built_in">require</span>(<span class="string">"mongoose"</span>)</div><div class="line"></div><div class="line">mongoose.connect(<span class="string">"mongodb://localhost/test"</span>)</div><div class="line"></div><div class="line"><span class="keyword">const</span> Topic = mongoose.model(<span class="string">"Topic"</span>, &#123;</div><div class="line">    <span class="attr">arr</span>: []</div><div class="line">&#125;)</div><div class="line"></div><div class="line">Topic.remove(&#123;&#125;, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line"></div><div class="line">    Topic.create(&#123;</div><div class="line">        <span class="attr">arr</span>: [<span class="number">11</span>, <span class="number">22</span>,<span class="number">11</span>, <span class="number">33</span>, <span class="number">44</span>, <span class="number">55</span>, <span class="number">66</span>]</div><div class="line">    &#125;).then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line"></div><div class="line">        <span class="comment">//  $pop删除一个</span></div><div class="line">        <span class="comment">// Topic.update(&#123;&#125;, &#123;</span></div><div class="line">        <span class="comment">//     $pop: &#123;</span></div><div class="line">        <span class="comment">//         arr: 1  //[11, 22, 33, 44, 55]  正数从后往前，负数从前往后</span></div><div class="line">        <span class="comment">//         //arr: -1 //[ 22, 33, 44, 55, 66]</span></div><div class="line">        <span class="comment">//     &#125;</span></div><div class="line">        <span class="comment">// &#125;).exec()</span></div><div class="line"></div><div class="line"></div><div class="line">        <span class="comment">//  $addToSet添加不重复</span></div><div class="line">        <span class="comment">// Topic.update(&#123;&#125;, &#123;</span></div><div class="line">        <span class="comment">//     $addToSet: &#123;</span></div><div class="line">        <span class="comment">//         // arr: 66     //如果重复，无法添加</span></div><div class="line">        <span class="comment">//         // arr: [77,88]    //[11, 22, 33, 44, 55, 66, [77,88]]并不是预期的效果</span></div><div class="line">        <span class="comment">//         arr: &#123;</span></div><div class="line">        <span class="comment">//             $each: [77, 88]     //[ 11, 22, 33, 44, 55, 66, 77, 88 ]</span></div><div class="line">        <span class="comment">//         &#125;</span></div><div class="line">        <span class="comment">//     &#125;</span></div><div class="line">        <span class="comment">// &#125;).exec()</span></div><div class="line"></div><div class="line">        <span class="comment">//  $pull删除一种数据</span></div><div class="line">        <span class="comment">// Topic.update(&#123;&#125;,&#123;</span></div><div class="line">        <span class="comment">//     $pull:&#123;</span></div><div class="line">        <span class="comment">//         arr:11  //[ 22, 33, 44, 55, 66 ]</span></div><div class="line">        <span class="comment">//         // arr:[11,22] //无效的</span></div><div class="line">        <span class="comment">//     &#125;</span></div><div class="line">        <span class="comment">// &#125;).exec()</span></div><div class="line"></div><div class="line">        <span class="comment">//  $pullAll删除多种数据</span></div><div class="line">        <span class="comment">// Topic.update(&#123;&#125;,&#123;</span></div><div class="line">        <span class="comment">//     $pullAll:&#123;</span></div><div class="line">        <span class="comment">//         arr:[11,22]  //[ 33, 44, 55, 66 ]</span></div><div class="line">        <span class="comment">//     &#125;</span></div><div class="line">        <span class="comment">// &#125;).exec()</span></div><div class="line"></div><div class="line">        <span class="comment">//  $push添加数据，可以重复</span></div><div class="line">        Topic.update(&#123;&#125;,&#123;</div><div class="line">            <span class="attr">$push</span>:&#123;</div><div class="line">                <span class="comment">// arr:66  //[ 11, 22, 11, 33, 44, 55, 66, 66 ]</span></div><div class="line">                arr:&#123;</div><div class="line">                    <span class="attr">$each</span>: [<span class="number">77</span>, <span class="number">88</span>],</div><div class="line">                    <span class="attr">$position</span>:<span class="number">0</span>,     <span class="comment">//从指定位置开始添加[ 77, 88, 11, 22, 11, 33, 44, 55, 66 ]</span></div><div class="line">                    $slice:<span class="number">-3</span>        <span class="comment">//截取数组，正数从前截取，负数从后截取</span></div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;).exec()</div><div class="line">    &#125;)</div><div class="line"></div><div class="line">&#125;)</div></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="对象的基础查询"><a href="#对象的基础查询" class="headerlink" title="对象的基础查询"></a>对象的基础查询</h3><ul>
<li>find(conditions , [projection] , [options] , [callback])</li>
<li>findById</li>
<li>findByIdAndRemove / findByIdAndUpdate</li>
<li>findOne</li>
<li>findOneAndRemove / findOneAndUpdate<br><strong><em>举个栗子</em></strong>   <figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> mongoose = <span class="built_in">require</span>(<span class="string">"mongoose"</span>)</div><div class="line">mongoose.connect(<span class="string">"mongodb://localhost/test"</span>)</div><div class="line"></div><div class="line"><span class="keyword">const</span> Topic = mongoose.model(<span class="string">"Topic"</span>, &#123;</div><div class="line">    <span class="attr">name</span>: &#123;</div><div class="line">        <span class="attr">type</span>: <span class="built_in">String</span>,</div><div class="line">        <span class="attr">maxlength</span>: <span class="number">10</span></div><div class="line">    &#125;</div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="keyword">const</span> arr = []</div><div class="line"></div><div class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">50</span>; i++) &#123;</div><div class="line">    arr.push(&#123;</div><div class="line">        <span class="attr">name</span>: <span class="string">"Jimmy"</span> + i</div><div class="line">    &#125;)</div><div class="line">&#125;</div><div class="line">Topic.remove(&#123;&#125;, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    Topic.create(arr).then(<span class="function"><span class="keyword">function</span>(<span class="params">objs</span>) </span>&#123;</div><div class="line">        <span class="keyword">let</span> id = objs[<span class="number">0</span>].id</div><div class="line">        <span class="comment">// Topic.findById(id, function(err, t) &#123;</span></div><div class="line">        <span class="comment">//     console.log(t);</span></div><div class="line">        <span class="comment">// &#125;)</span></div><div class="line"></div><div class="line">        <span class="comment">// Topic.findByIdAndRemove(id, function(err, t) &#123;</span></div><div class="line">        <span class="comment">//     console.log(t);</span></div><div class="line">        <span class="comment">// &#125;)</span></div><div class="line"></div><div class="line">        <span class="comment">// Topic.findByIdAndUpdate(id, &#123;</span></div><div class="line">        <span class="comment">//     name: "hahahaha111111111"</span></div><div class="line">        <span class="comment">// &#125;, &#123;</span></div><div class="line">        <span class="comment">//     runValidators: true</span></div><div class="line">        <span class="comment">// &#125;, function(err, t) &#123;</span></div><div class="line">        <span class="comment">//     console.log(err, t);</span></div><div class="line">        <span class="comment">// &#125;)</span></div><div class="line">        <span class="comment">// 上面这个和这个一样的效果</span></div><div class="line">        <span class="comment">// Topic.findByIdAndUpdate(id, &#123;</span></div><div class="line">        <span class="comment">//     name: "hahahaha111111111"</span></div><div class="line">        <span class="comment">// &#125;, &#123;</span></div><div class="line">        <span class="comment">//     runValidators: true</span></div><div class="line">        <span class="comment">// &#125;).then(function(t) &#123;</span></div><div class="line">        <span class="comment">//     console.log(t);</span></div><div class="line">        <span class="comment">// &#125;).catch(err =&gt; console.log(err))</span></div><div class="line">        <span class="comment">// 效果还是一样的，错误交由外部处理</span></div><div class="line">        <span class="comment">// return Topic.findByIdAndUpdate(id, &#123;</span></div><div class="line">        <span class="comment">//     name: "hahahaha111111111"</span></div><div class="line">        <span class="comment">// &#125;, &#123;</span></div><div class="line">        <span class="comment">//     runValidators: true</span></div><div class="line">        <span class="comment">// &#125;).then(function(t) &#123;</span></div><div class="line">        <span class="comment">//     console.log(t);</span></div><div class="line">        <span class="comment">// &#125;)</span></div><div class="line"></div><div class="line">        <span class="comment">// Topic.findOne(&#123;name:/^Jimmy1\d$/&#125;,function(err,t)&#123;  //返回满足条件的第一个</span></div><div class="line">        <span class="comment">//     console.log(t);</span></div><div class="line">        <span class="comment">// &#125;)</span></div><div class="line"></div><div class="line">        <span class="comment">// Topic.find(&#123;&#125;,function(err,ts)&#123;</span></div><div class="line">        <span class="comment">//     console.log(ts);</span></div><div class="line">        <span class="comment">// &#125;)</span></div><div class="line">        <span class="comment">// Topic.find(&#123;name:/^Jimmy1\d$/&#125;,function(err,ts)&#123;</span></div><div class="line">        <span class="comment">//     console.log(ts);</span></div><div class="line">        <span class="comment">// &#125;)</span></div><div class="line">        <span class="comment">// Topic.find(&#123;name:/^Jimmy1\d$/&#125;,"_id name",function(err,ts)&#123;  //第二个参数决定返回结果带有的属性，用空格分割，如果在属性前加-，则表示不返回这个属性</span></div><div class="line">        <span class="comment">//     console.log(ts);</span></div><div class="line">        <span class="comment">// &#125;)</span></div><div class="line">        Topic.find(&#123;<span class="attr">name</span>:<span class="regexp">/^Jimmy1\d$/</span>&#125;,<span class="literal">null</span>,&#123;<span class="attr">skip</span>:<span class="number">5</span>,<span class="attr">limit</span>:<span class="number">3</span>&#125;,<span class="function"><span class="keyword">function</span>(<span class="params">err,ts</span>)</span>&#123; <span class="comment">//第三个参数是对结果的筛选，skip指跳过几个，limit指最多返回几个，结合这两个可以实现翻页功能</span></div><div class="line">            <span class="built_in">console</span>.log(ts);</div><div class="line">        &#125;)</div><div class="line"></div><div class="line">    &#125;).catch(<span class="function"><span class="params">err</span> =&gt;</span> <span class="built_in">console</span>.log(err))</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="比较式查询"><a href="#比较式查询" class="headerlink" title="比较式查询"></a>比较式查询</h3><ul>
<li>大小判断<ul>
<li>$eq 等于</li>
<li>$gt 大于</li>
<li>$gte 大于等于</li>
<li>$lt 小于</li>
<li>$lte 小于等于</li>
</ul>
</li>
<li>$ne 不是</li>
<li>$in 包含</li>
<li>$nin 不包含<br><strong><em>举个栗子</em></strong>   <figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> mongoose = <span class="built_in">require</span>(<span class="string">"mongoose"</span>)</div><div class="line">mongoose.connect(<span class="string">"mongodb://localhost/test"</span>)</div><div class="line"></div><div class="line"><span class="keyword">const</span> Topic = mongoose.model(<span class="string">"Topic"</span>, &#123;</div><div class="line">    <span class="attr">name</span>: &#123;</div><div class="line">        <span class="attr">type</span>: <span class="built_in">String</span>,</div><div class="line">        <span class="attr">maxlength</span>: <span class="number">10</span></div><div class="line">    &#125;,</div><div class="line">    <span class="attr">num</span>: <span class="built_in">Number</span></div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="keyword">const</span> arr = []</div><div class="line"></div><div class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">50</span>; i++) &#123;</div><div class="line">    arr.push(&#123;</div><div class="line">        <span class="attr">name</span>: <span class="string">"Jimmy"</span> + i,</div><div class="line">        <span class="attr">num</span>: i</div><div class="line">    &#125;)</div><div class="line">&#125;</div><div class="line">Topic.remove(&#123;&#125;, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    Topic.create(arr).then(<span class="function"><span class="keyword">function</span>(<span class="params">objs</span>) </span>&#123;</div><div class="line"></div><div class="line">        Topic.find(&#123;</div><div class="line">            <span class="attr">num</span>: &#123;</div><div class="line">                <span class="comment">// $lt: 20,    //小于20</span></div><div class="line">                <span class="comment">// $lte:20,    //小于等于20</span></div><div class="line">                <span class="comment">// $gt:10,      //大于10</span></div><div class="line">                <span class="comment">// $gte:10,     //大于等于10</span></div><div class="line">                <span class="comment">// $in: [11, 15], //值等于11或15</span></div><div class="line">                <span class="comment">// $nin: [11, 15], //值不等于11或15</span></div><div class="line">                <span class="comment">// $ne: 2, //不等于2的，只能一个值</span></div><div class="line">                $eq: <span class="number">2</span>, <span class="comment">//等于2的</span></div><div class="line">            &#125;</div><div class="line">        &#125;, <span class="function"><span class="keyword">function</span>(<span class="params">err, ts</span>) </span>&#123;</div><div class="line">            <span class="built_in">console</span>.log(ts);</div><div class="line">        &#125;)</div><div class="line">    &#125;)</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="逻辑式查询"><a href="#逻辑式查询" class="headerlink" title="逻辑式查询"></a>逻辑式查询</h3><ul>
<li>$or 或</li>
<li>$nor ($or相反)</li>
<li>$and 和</li>
<li>$not 否<br><strong><em>举个栗子</em></strong>   <figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> mongoose = <span class="built_in">require</span>(<span class="string">"mongoose"</span>)</div><div class="line">mongoose.connect(<span class="string">"mongodb://localhost/test"</span>)</div><div class="line"></div><div class="line"><span class="keyword">const</span> Topic = mongoose.model(<span class="string">"Topic"</span>, &#123;</div><div class="line">    <span class="attr">name</span>: &#123;</div><div class="line">        <span class="attr">type</span>: <span class="built_in">String</span>,</div><div class="line">        <span class="attr">maxlength</span>: <span class="number">10</span></div><div class="line">    &#125;,</div><div class="line">    <span class="attr">num</span>: <span class="built_in">Number</span></div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="keyword">const</span> arr = []</div><div class="line"></div><div class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">50</span>; i++) &#123;</div><div class="line">    arr.push(&#123;</div><div class="line">        <span class="attr">name</span>: <span class="string">"Jimmy"</span> + i,</div><div class="line">        <span class="attr">num</span>: i</div><div class="line">    &#125;)</div><div class="line">&#125;</div><div class="line">Topic.remove(&#123;&#125;, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    Topic.create(arr).then(<span class="function"><span class="keyword">function</span>(<span class="params">objs</span>) </span>&#123;</div><div class="line"></div><div class="line">        Topic.find(&#123;</div><div class="line">            <span class="comment">// $or: [&#123;     //满足一个条件就会返回</span></div><div class="line">            <span class="comment">//     name: "Jimmy1"</span></div><div class="line">            <span class="comment">// &#125;, &#123;</span></div><div class="line">            <span class="comment">//     num: 4</span></div><div class="line">            <span class="comment">// &#125;,&#123;</span></div><div class="line">            <span class="comment">//     num: 6</span></div><div class="line">            <span class="comment">// &#125;]</span></div><div class="line"></div><div class="line">            <span class="comment">// $nor: [&#123;        //不满足所有条件就返回</span></div><div class="line">            <span class="comment">//     name: "Jimmy1"</span></div><div class="line">            <span class="comment">// &#125;, &#123;</span></div><div class="line">            <span class="comment">//     num: 4</span></div><div class="line">            <span class="comment">// &#125;, &#123;</span></div><div class="line">            <span class="comment">//     num: 6</span></div><div class="line">            <span class="comment">// &#125;]</span></div><div class="line"></div><div class="line">            <span class="comment">// $and: [&#123;        //满足所有条件才返回</span></div><div class="line">            <span class="comment">//     name: /^Jimmy1\d$/</span></div><div class="line">            <span class="comment">// &#125;, &#123;</span></div><div class="line">            <span class="comment">//     num: &#123;</span></div><div class="line">            <span class="comment">//         $lte:15</span></div><div class="line">            <span class="comment">//     &#125;</span></div><div class="line">            <span class="comment">// &#125;]</span></div><div class="line">            <span class="comment">// $and: [&#123;        //可以混合使用</span></div><div class="line">            <span class="comment">//     $or: [&#123;</span></div><div class="line">            <span class="comment">//         name: "Jimmy1"</span></div><div class="line">            <span class="comment">//     &#125;, &#123;</span></div><div class="line">            <span class="comment">//         num: 4</span></div><div class="line">            <span class="comment">//     &#125;, &#123;</span></div><div class="line">            <span class="comment">//         num: 6</span></div><div class="line">            <span class="comment">//     &#125;]</span></div><div class="line">            <span class="comment">// &#125;, &#123;</span></div><div class="line">            <span class="comment">//     num: 4</span></div><div class="line">            <span class="comment">// &#125;]</span></div><div class="line"></div><div class="line">            num: &#123;</div><div class="line">                <span class="attr">$not</span>: &#123; <span class="comment">//不满足条件的返回</span></div><div class="line">                    $gte: <span class="number">10</span></div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line"></div><div class="line">        &#125;, <span class="function"><span class="keyword">function</span>(<span class="params">err, ts</span>) </span>&#123;</div><div class="line">            <span class="built_in">console</span>.log(ts);</div><div class="line">        &#125;)</div><div class="line">    &#125;)</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="数组专用查询"><a href="#数组专用查询" class="headerlink" title="数组专用查询"></a>数组专用查询</h3><ul>
<li>$all 是否包含查询条件</li>
<li>$elemMatch 数组元素查询条件</li>
<li>$size 数组大小查询条件</li>
<li>$where 其他<br><strong><em>举个栗子</em></strong>   <figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> mongoose = <span class="built_in">require</span>(<span class="string">"mongoose"</span>)</div><div class="line">mongoose.connect(<span class="string">"mongodb://localhost/test"</span>)</div><div class="line"><span class="comment">//$all&amp;$elemMatch</span></div><div class="line"><span class="comment">// const Topic = mongoose.model("Topic", &#123;</span></div><div class="line"><span class="comment">//     arr: []</span></div><div class="line"><span class="comment">// &#125;)</span></div><div class="line"></div><div class="line"><span class="comment">//$all</span></div><div class="line"><span class="comment">// Topic.remove(&#123;&#125;, function() &#123;</span></div><div class="line"><span class="comment">//     Topic.create([&#123;</span></div><div class="line"><span class="comment">//             arr: [11, 22, 33]</span></div><div class="line"><span class="comment">//         &#125;,</span></div><div class="line"><span class="comment">//         &#123;</span></div><div class="line"><span class="comment">//             arr: [33, 44, 55]</span></div><div class="line"><span class="comment">//         &#125;,</span></div><div class="line"><span class="comment">//         &#123;</span></div><div class="line"><span class="comment">//             arr: [55, 66, 77, 88]</span></div><div class="line"><span class="comment">//         &#125;</span></div><div class="line"><span class="comment">//     ]).then(function() &#123;</span></div><div class="line"><span class="comment">//         Topic.find(&#123;</span></div><div class="line"><span class="comment">//             arr: &#123;</span></div><div class="line"><span class="comment">//                 $all: [33, 44] //都存在的返回</span></div><div class="line"><span class="comment">//             &#125;</span></div><div class="line"><span class="comment">//         &#125;).then((result) =&gt; &#123;</span></div><div class="line"><span class="comment">//             console.log(result);</span></div><div class="line"><span class="comment">//         &#125;)</span></div><div class="line"><span class="comment">//     &#125;)</span></div><div class="line"><span class="comment">// &#125;)</span></div><div class="line"></div><div class="line"><span class="comment">//$elemMatch</span></div><div class="line"><span class="comment">// function generatorArr(size) &#123;</span></div><div class="line"><span class="comment">//     let arr = []</span></div><div class="line"><span class="comment">//     for (let i = 0; i &lt; size; i++) &#123;</span></div><div class="line"><span class="comment">//         arr.push(&#123;</span></div><div class="line"><span class="comment">//             name: "Jimmy" + i,</span></div><div class="line"><span class="comment">//             num: i</span></div><div class="line"><span class="comment">//         &#125;)</span></div><div class="line"><span class="comment">//     &#125;</span></div><div class="line"><span class="comment">//     return arr</span></div><div class="line"><span class="comment">// &#125;</span></div><div class="line"><span class="comment">//</span></div><div class="line"><span class="comment">// Topic.remove(&#123;&#125;, function() &#123;</span></div><div class="line"><span class="comment">//     Topic.create([&#123;</span></div><div class="line"><span class="comment">//             arr: generatorArr(5)</span></div><div class="line"><span class="comment">//         &#125;,</span></div><div class="line"><span class="comment">//         &#123;</span></div><div class="line"><span class="comment">//             arr: generatorArr(10)</span></div><div class="line"><span class="comment">//         &#125;,</span></div><div class="line"><span class="comment">//         &#123;</span></div><div class="line"><span class="comment">//             arr: generatorArr(15)</span></div><div class="line"><span class="comment">//         &#125;</span></div><div class="line"><span class="comment">//     ]).then(function() &#123;</span></div><div class="line"><span class="comment">//         Topic.find(&#123;</span></div><div class="line"><span class="comment">//             arr: &#123;</span></div><div class="line"><span class="comment">//                 // $elemMatch: &#123;       //匹配数组内部元素的数据</span></div><div class="line"><span class="comment">//                 //     name: "Jimmy9"</span></div><div class="line"><span class="comment">//                 // &#125;</span></div><div class="line"><span class="comment">//                 $size: 5        //匹配数组length</span></div><div class="line"><span class="comment">//             &#125;</span></div><div class="line"><span class="comment">//         &#125;).then((result) =&gt; &#123;</span></div><div class="line"><span class="comment">//             console.log(result);</span></div><div class="line"><span class="comment">//         &#125;)</span></div><div class="line"><span class="comment">//     &#125;)</span></div><div class="line"><span class="comment">// &#125;)</span></div><div class="line"></div><div class="line"><span class="comment">//$where</span></div><div class="line"><span class="keyword">const</span> Topic = mongoose.model(<span class="string">"Topic"</span>, &#123;</div><div class="line">    <span class="attr">obj</span>: &#123;&#125;</div><div class="line">&#125;)</div><div class="line">Topic.remove(&#123;&#125;, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    Topic.create([&#123;</div><div class="line">        <span class="attr">obj</span>: &#123;</div><div class="line">            <span class="attr">name</span>: <span class="string">"java"</span>,</div><div class="line">            <span class="attr">num</span>: <span class="number">1</span></div><div class="line">        &#125;</div><div class="line">    &#125;, &#123;</div><div class="line">        <span class="attr">obj</span>: &#123;</div><div class="line">            <span class="attr">name</span>: <span class="string">"javascript"</span>,</div><div class="line">            <span class="attr">num</span>: <span class="number">2</span></div><div class="line">        &#125;</div><div class="line">    &#125;, &#123;</div><div class="line">        <span class="attr">obj</span>: &#123;</div><div class="line">            <span class="attr">name</span>: <span class="string">"nodejs"</span>,</div><div class="line">            <span class="attr">num</span>: <span class="number">3</span></div><div class="line">        &#125;</div><div class="line">    &#125;]).then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">        Topic.find(&#123;</div><div class="line">            <span class="comment">// $where: "this.obj.name === 'java'"      //直接写js</span></div><div class="line">            $where: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">                <span class="keyword">return</span> <span class="regexp">/^java\w*$/</span>.test(<span class="keyword">this</span>.obj.name) &amp;&amp; <span class="keyword">this</span>.obj.num === <span class="number">2</span></div><div class="line">            &#125;</div><div class="line">        &#125;, <span class="literal">null</span>, &#123; <span class="comment">//同样可以混合使用</span></div><div class="line">            limit: <span class="number">2</span>,</div><div class="line">            <span class="attr">skip</span>: <span class="number">0</span></div><div class="line">        &#125;).then(<span class="function"><span class="keyword">function</span>(<span class="params">result</span>) </span>&#123;</div><div class="line">            <span class="built_in">console</span>.log(result);</div><div class="line">        &#125;)</div><div class="line">    &#125;)</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="Query查询风格"><a href="#Query查询风格" class="headerlink" title="Query查询风格"></a>Query查询风格</h3><p>另一种风格的写法，作为了解，下面例子将会改写上面的例子<br><strong><em>举个栗子</em></strong><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div></pre></td><td class="code"><pre><div class="line">Topic.create([&#123;</div><div class="line">        <span class="attr">arr</span>: [<span class="number">11</span>, <span class="number">22</span>, <span class="number">33</span>]</div><div class="line">    &#125;,</div><div class="line">    &#123;</div><div class="line">        <span class="attr">arr</span>: [<span class="number">33</span>, <span class="number">44</span>, <span class="number">55</span>]</div><div class="line">    &#125;,</div><div class="line">    &#123;</div><div class="line">        <span class="attr">arr</span>: [<span class="number">55</span>, <span class="number">66</span>, <span class="number">77</span>, <span class="number">88</span>]</div><div class="line">    &#125;</div><div class="line">]).then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">let</span> query = Topic.find()</div><div class="line">    query.where(<span class="string">"arr"</span>)</div><div class="line">        .all([<span class="number">33</span>,<span class="number">44</span>])</div><div class="line">        .limit(<span class="number">3</span>)</div><div class="line">        .skip(<span class="number">10</span>)</div><div class="line">        .select(<span class="string">"name age"</span>)</div><div class="line">        .exec(<span class="function"><span class="keyword">function</span> (<span class="params">err,result</span>)</span>&#123;</div><div class="line">            <span class="built_in">console</span>.log(result)</div><div class="line">        &#125;)</div><div class="line">&#125;)</div><div class="line"><span class="comment">//elemMatch的query写法</span></div><div class="line">Topic.create([&#123;</div><div class="line">        <span class="attr">arr</span>: generatorArr(<span class="number">5</span>)</div><div class="line">    &#125;,</div><div class="line">    &#123;</div><div class="line">        <span class="attr">arr</span>: generatorArr(<span class="number">10</span>)</div><div class="line">    &#125;,</div><div class="line">    &#123;</div><div class="line">        <span class="attr">arr</span>: generatorArr(<span class="number">15</span>)</div><div class="line">    &#125;</div><div class="line">]).then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    Topic.find()</div><div class="line">    .where(<span class="string">"arr"</span>)</div><div class="line">    .elemMatch(&#123;<span class="attr">name</span>:<span class="string">"Jimmy9"</span>&#125;)</div><div class="line">    .exec(<span class="function"><span class="keyword">function</span> (<span class="params">err,result</span>)</span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(result)</div><div class="line">    &#125;)</div><div class="line"></div><div class="line">    <span class="comment">//另一种写法</span></div><div class="line">    Topic.find()</div><div class="line">    .where(<span class="string">"arr"</span>)</div><div class="line">    .elemMatch(<span class="function"><span class="keyword">function</span> (<span class="params">elem</span>)</span>&#123;</div><div class="line">        elem.where(<span class="string">"name"</span>).eq(<span class="string">"Jimmy9"</span>).where(<span class="string">"num"</span>).gte() ....</div><div class="line">    &#125;)</div><div class="line">    .exec(<span class="function"><span class="keyword">function</span> (<span class="params">err,result</span>)</span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(result)</div><div class="line">    &#125;)</div><div class="line">&#125;)</div></pre></td></tr></table></figure></p>
<p>具体可以查看文档<a href="http://mongoosejs.com/docs/queries.html" target="_blank" rel="external">http://mongoosejs.com/docs/queries.html</a></p>
<h3 id="中间件"><a href="#中间件" class="headerlink" title="中间件"></a>中间件</h3><p>会触发中间件的：</p>
<ul>
<li>validate</li>
<li>doc.save</li>
<li>Class.create / Class.insertMany</li>
<li>doc.update</li>
<li>doc.remove</li>
<li>find</li>
<li>findOne</li>
<li>findAndRemove / findOneAndUpdate<br><strong><em>举个栗子</em></strong>   <figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> mongoose = <span class="built_in">require</span>(<span class="string">"mongoose"</span>)</div><div class="line"></div><div class="line">mongoose.connect(<span class="string">"mongodb://localhost/test"</span>)</div><div class="line"></div><div class="line"><span class="keyword">const</span> userSchema = <span class="keyword">new</span> mongoose.Schema(&#123;</div><div class="line">    <span class="attr">name</span>: &#123;</div><div class="line">        <span class="attr">type</span>: <span class="built_in">String</span>,</div><div class="line">        <span class="attr">maxlength</span>: <span class="number">5</span></div><div class="line">    &#125;</div><div class="line">&#125;)</div><div class="line">userSchema.pre(<span class="string">"validate"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">next</span>) </span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">"pre validate"</span>);</div><div class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.errors);</div><div class="line">    next()</div><div class="line">&#125;)</div><div class="line"></div><div class="line">userSchema.post(<span class="string">"validate"</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="comment">// console.log(this.errors?this.errors.name.message:this.errors);</span></div><div class="line">    <span class="built_in">console</span>.log(<span class="string">"post validate"</span>);</div><div class="line">&#125;)</div><div class="line"></div><div class="line"><span class="comment">// userSchema.pre("save", function(next) &#123;</span></div><div class="line"><span class="comment">//     console.log("pre save one");</span></div><div class="line"><span class="comment">//     next()</span></div><div class="line"><span class="comment">// &#125;)</span></div><div class="line">userSchema.pre(<span class="string">"save"</span>,<span class="literal">true</span>, <span class="function"><span class="keyword">function</span>(<span class="params">next,done</span>) </span>&#123;    <span class="comment">//默认不加true，加true表示并行,在执行完所有的pre之后在执行后面的，没什么卵用的功能，完全能用next来控制</span></div><div class="line">    <span class="built_in">console</span>.log(<span class="string">"pre save one"</span>);</div><div class="line">    next()</div><div class="line">    setTimeout(done,<span class="number">2000</span>)</div><div class="line">&#125;)</div><div class="line"></div><div class="line">userSchema.pre(<span class="string">"save"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">next</span>) </span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">"pre save two"</span>);</div><div class="line">    setTimeout(next,<span class="number">2000</span>)</div><div class="line">&#125;)</div><div class="line"></div><div class="line">userSchema.post(<span class="string">"save"</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">"post save"</span>);</div><div class="line">&#125;)</div><div class="line"></div><div class="line">userSchema.pre(<span class="string">"update"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">next</span>) </span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">"pre update"</span>);</div><div class="line">    next()</div><div class="line">&#125;)</div><div class="line"></div><div class="line">userSchema.post(<span class="string">"update"</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">"post update"</span>);</div><div class="line">&#125;)</div><div class="line"></div><div class="line">userSchema.pre(<span class="string">"remove"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">next</span>) </span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">"pre remove"</span>);</div><div class="line">    next()</div><div class="line">&#125;)</div><div class="line">userSchema.post(<span class="string">"remove"</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">"post remove"</span>);</div><div class="line">&#125;)</div><div class="line"><span class="keyword">const</span> User = mongoose.model(<span class="string">"User"</span>, userSchema)</div><div class="line"></div><div class="line">User.remove(&#123;&#125;, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> user = <span class="keyword">new</span> User(&#123;</div><div class="line">        <span class="attr">name</span>: <span class="string">"Jia"</span></div><div class="line">    &#125;)</div><div class="line"></div><div class="line">    user.save(<span class="function"><span class="keyword">function</span>(<span class="params">err, u</span>) </span>&#123;</div><div class="line">        u.update(&#123;</div><div class="line">            <span class="attr">name</span>: <span class="string">"Jimmy"</span></div><div class="line">        &#125;).then(<span class="function"><span class="keyword">function</span>(<span class="params">result</span>)</span>&#123;</div><div class="line"></div><div class="line">            u.remove()</div><div class="line">        &#125;)</div><div class="line">    &#125;)</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
</li>
</ul>
<p><strong><em>END</em></strong></p>

        </div>

        <blockquote class="post-copyright">
    <div class="content">
        
<span class="post-time">
    最后更新时间：<time datetime="2017-02-07T09:20:10.000Z" itemprop="dateUpdated">2017年2月7日 17:20</time>
</span><br>


        转载请注明出处：<a href="/2017/02/07/Mongoose入门/" target="_blank" rel="external">http://YongMaple.com/2017/02/07/Mongoose入门/</a>
    </div>
    <footer>
        <a href="http://YongMaple.github.io">
            <img src="/img/avatar.png" alt="YongMaple">
            YongMaple
        </a>
    </footer>
</blockquote>

        
<div class="page-reward">
    <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-circle waves-light">赏</a>
</div>



        <div class="post-footer">
            
	<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/mongodb/">mongodb</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/mongoose/">mongoose</a></li></ul>


            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://YongMaple.github.io/2017/02/07/Mongoose入门/&title=《Mongoose入门》 — YongMaple&pic=http://YongMaple.github.io/img/avatar.png" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://YongMaple.github.io/2017/02/07/Mongoose入门/&title=《Mongoose入门》 — YongMaple&source=我不生产代码，我只是代码的搬运工" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://YongMaple.github.io/2017/02/07/Mongoose入门/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《Mongoose入门》 — YongMaple&url=http://YongMaple.github.io/2017/02/07/Mongoose入门/&via=http://YongMaple.github.io" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://YongMaple.github.io/2017/02/07/Mongoose入门/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between flex-row-reverse">
  

  
    <div class="waves-block waves-effect next">
      <a href="/2017/02/04/IOS设置document-title无效的解决办法/" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">IOS设置document.title无效的解决办法</h4>
      </a>
    </div>
  
</nav>



    

<div class="comments" id="comments">
    <div class="ds-thread" data-thread-key="Mongoose入门" data-title="Mongoose入门" data-url="http://YongMaple.github.io/2017/02/07/Mongoose入门/"></div>
</div>
<script>
lazyScripts.push('//cdn.bootcss.com/marked/0.3.6/marked.min.js');

var duoshuoQuery = {short_name:'yongmaple', theme: 'none'};
lazyScripts.push('/js/embed.min.js?v=1.4.6');


</script>







</article>

<div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        谢谢大爷~
        <i class="icon icon-quote-right"></i>
    </h3>
    <ul class="reward-items">
        
        <li>
            <img src="/img/wechat.jpg" title="微信打赏二维码" alt="微信打赏二维码">
            <p>微信</p>
        </li>
        

        
        <li>
            <img src="/img/alipay.jpg" title="支付宝打赏二维码" alt="支付宝打赏二维码">
            <p>支付宝</p>
        </li>
        
    </ul>
</div>



</div>

        <footer class="footer">
    <div class="top">
        

        <p>
            <span><a href="/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-lg icon-rss"></i></a></span>
            <span>博客内容遵循 <a href="http://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">知识共享 署名 - 非商业性 - 相同方式共享 4.0协议</a></span>
        </p>
    </div>
    <div class="bottom">
        <p>
            <span>Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank">indigo</a></span>
            <span>YongMaple &copy; 2015 - 2017</span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://YongMaple.github.io/2017/02/07/Mongoose入门/&title=《Mongoose入门》 — YongMaple&pic=http://YongMaple.github.io/img/avatar.png" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://YongMaple.github.io/2017/02/07/Mongoose入门/&title=《Mongoose入门》 — YongMaple&source=我不生产代码，我只是代码的搬运工" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://YongMaple.github.io/2017/02/07/Mongoose入门/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《Mongoose入门》 — YongMaple&url=http://YongMaple.github.io/2017/02/07/Mongoose入门/&via=http://YongMaple.github.io" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://YongMaple.github.io/2017/02/07/Mongoose入门/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAACKklEQVR42u3ay26DMBAFUP7/p9NNNxWC3BmbStiHVdVA7MNiMg8fR3x9Lq7zPef7z58mqxxPXBgYGK9lfG6v+wWSp5JVknXvXyIGBsYOjKsIdnVPElLzTdzj7/eGgYGBMZLYJWH6CoyBgYExi9FbMkkfMTAwMHpFbP7UeJn6YC2OgYHxQkbedf//vx+Zb2BgYLyK0QuRIwnf3OHB77MYGBhLM2a10vIWW3KoonksAwMDY1HGePma39NLOqPvwcDA2IBRPVqRN7/ybfUOYfwJuBgYGIsy8kCcJ3B56ZsML5NVMDAw9mSMDw+qCegjKSMGBsYSjLxNnwfWvPWWBNmIjYGBsQ0jH1s+cdaj91IKk1gMDIwlGNU2WY4cTwGjriEGBsY2jLzR1jsqkQfoPKHEwMBYm1FN+Hpt/WS7+Tghyi4xMDAWZVSLzGrpmw8PmoctMDAwNmD0ttULvr1vPsbfNAYGxgsZI0e+ekPKXqj98n8MDIylGdWAOxLXxw9nfGn2YWBgbMbIU8C8cTYr7F5+JwYGxgaM6lbu76mG1N7YEgMDYzdGPsicmwImhe603w0MDIwXMsYHk3nYrR71KLxWDAyMpRn5lWy3V6bmvwy914SBgbEGozcSKDfuW4PSQpDFwMDYgFGoeocbcw/W4hgYGBjFYjJPFicc7MDAwMAYaHX1BpZ5Sw4DA2MfRt7orx7hqg4YmqUyBgbG0oxe6dhr8SebrmIwMDCWZvwAWJxBz5pR9SsAAAAASUVORK5CYII=" alt="微信分享二维码">
</div>




    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: true };



lazyScripts.push('//s95.cnzz.com/z_stat.php?id=1261153759&web_id=1261153759')

</script>

<script src="/js/main.min.js?v=1.4.6"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="/js/search.min.js?v=1.4.6" async></script>







</body>
</html>
