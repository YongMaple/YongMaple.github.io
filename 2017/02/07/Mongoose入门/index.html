<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content=""><title>Mongoose入门 | 大枫</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=1.0.0"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/normalize.css/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/purecss/build/pure-min.min.css"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/purecss/build/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"><script>!function(e,a,t,n,g,c,o){e.GoogleAnalyticsObject=g,e.ga=e.ga||function(){(e.ga.q=e.ga.q||[]).push(arguments)},e.ga.l=1*new Date,c=a.createElement(t),o=a.getElementsByTagName(t)[0],c.async=1,c.src="https://www.google-analytics.com/analytics.js",o.parentNode.insertBefore(c,o)}(window,document,"script",0,"ga"),ga("create","G-Z06B9NZ0K4","auto"),ga("send","pageview")</script><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?da39e67eca8f9b3743e259caf04feb96";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><script type="text/javascript" src="//cdn.jsdelivr.net/npm/clipboard/dist/clipboard.min.js"></script><script type="text/javascript" src="//cdn.jsdelivr.net/gh/codeseven/toastr/build/toastr.min.js"></script><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/codeseven/toastr/build/toastr.min.css"><meta name="generator" content="Hexo 5.4.0"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Mongoose入门</h1><a id="logo" href="/.">大枫</a><p class="description">Stay Hungry.Stay Foolish.</p></div><div id="nav-menu"> <a class="current" href="/."><i class="fa fa-home">首页</i></a> <a href="/archives/"><i class="fa fa-archive">归档</i></a> <a href="/about/"><i class="fa fa-user">关于</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Mongoose入门</h1><div class="post-meta">2017-02-07 <span>|</span> <span class="category"><a href="/categories/%E5%90%8E%E7%AB%AF/">后端</a></span><script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script> <span id="busuanzi_container_page_pv">|<span id="busuanzi_value_page_pv"></span> <span>阅读</span></span> <span class="post-time"><span class="post-meta-item-text">|</span><span class="post-meta-item-icon"><i class="fa fa-keyboard-o"></i> <span class="post-count">5.1k</span> <span class="post-meta-item-text">字</span></span></span> <span class="post-time">|<span class="post-meta-item-icon"><i class="fa fa-clock-o"></i> <span class="post-count">26</span> <span class="post-meta-item-text">分钟</span></span></span></div><a class="disqus-comment-count" href="/2017/02/07/Mongoose%E5%85%A5%E9%97%A8/#vcomment"><span class="valine-comment-count" data-xid="/2017/02/07/Mongoose%E5%85%A5%E9%97%A8/"></span> <span>条评论</span></a><div class="post-content"><h2 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h2><h3 id="安装Node-js和MongoDB"><a href="#安装Node-js和MongoDB" class="headerlink" title="安装Node.js和MongoDB"></a>安装Node.js和MongoDB</h3><p>安装Node.js，地址：<a target="_blank" rel="noopener" href="https://nodejs.org/">https://nodejs.org/</a><br>安装MongoDB，地址：<a target="_blank" rel="noopener" href="https://www.mongodb.com/download-center?jmp=nav#community">https://www.mongodb.com/</a></p><h3 id="启动MongoDB"><a href="#启动MongoDB" class="headerlink" title="启动MongoDB"></a>启动MongoDB</h3><p>cd到mongodb下的bin文件夹，执行<code>./mongod</code>即可，但是我们执行后会出如下错误<br><img src="http://okmneu7zl.bkt.clouddn.com/WX20170131-131657.png"><br>这里提示我们没有/data/db文件夹，需要我们自己来新建，这里我在mongodb-3.4.0下新建了mydata文件夹，并通过<code>./mongod --dbpath ../mydata</code>启动了MongoDB，<code>--datapath</code>是用来指定路径的<br><img src="http://okmneu7zl.bkt.clouddn.com/WX20170131-133558@2x.png"><br>那么让我们来体验一下mongodb吧，首先要新建一个tab，然后同样cd到bin目录下，执行<code>./mongo</code><br><img src="http://okmneu7zl.bkt.clouddn.com/WX20170131-134433.png"><br>然后我们切回之前的tab可以看到有一个新的连接<br><img src="http://okmneu7zl.bkt.clouddn.com/WX20170131-134649.png"></p><h3 id="MongoDB基础命令"><a href="#MongoDB基础命令" class="headerlink" title="MongoDB基础命令"></a>MongoDB基础命令</h3><p><img src="http://okmneu7zl.bkt.clouddn.com/WX20170131-135808.png"><br>因为我们后期基本不会在shell里来操作，所有这里只讲几个基本的，下面的test可以随意命名，是集合名</p><ul><li><code>db.test.insert()</code>在集合中插入一条数据</li><li><code>db.test.find()</code>查找集合中所有的，可以加入参数，如<code>db.test.find(&#123;name:&quot;Jimmy&quot;&#125;)</code></li><li><code>db.test.remove(&#123;&#125;)</code>删除集合中所有元素，<code>&#123;&#125;</code>必须写</li><li><code>show collections</code>查看所有集合</li></ul><h3 id="mongoose的安装"><a href="#mongoose的安装" class="headerlink" title="mongoose的安装"></a>mongoose的安装</h3><p>新建一个文件夹，通过<code>npm init</code>初始化，通过<code>npm install mongoose --save</code>安装mongoose<br><img src="http://okmneu7zl.bkt.clouddn.com/WX20170131-142334.png"></p><h3 id="通过mongoose连接数据库"><a href="#通过mongoose连接数据库" class="headerlink" title="通过mongoose连接数据库"></a>通过mongoose连接数据库</h3><p>新建一个js文件，复制以下代码并在shell运行<code>node xxx.js</code>，xxx为你的文件名</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> mongoose = <span class="built_in">require</span>(<span class="string">&quot;mongoose&quot;</span>);</span><br><span class="line">mongoose.connect(<span class="string">&quot;mongodb://localhost/test&quot;</span>)</span><br></pre></td></tr></table></figure><p>运行之后在之前的mongod的tab中看到有了一个新的连接</p><h2 id="Mongoose入门"><a href="#Mongoose入门" class="headerlink" title="Mongoose入门"></a>Mongoose入门</h2><h3 id="创建类Class的方式"><a href="#创建类Class的方式" class="headerlink" title="创建类Class的方式"></a>创建类Class的方式</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> User = mongoose.model(<span class="string">&quot;User&quot;</span>,userSchema)</span><br></pre></td></tr></table></figure><p><code>&quot;User&quot;</code>表示类名，在数据库中集合名会自动转化为小写加s<code>users</code></p><p><code>userSchema</code>定义了对象的原型 ·</p><p><em><strong>举个栗子</strong></em></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> mongoose = <span class="built_in">require</span>(<span class="string">&quot;mongoose&quot;</span>);</span><br><span class="line">mongoose.connect(<span class="string">&quot;mongodb://localhost/test&quot;</span>)</span><br><span class="line"></span><br><span class="line">userSchema = <span class="keyword">new</span> mongoose.Schema(&#123;  <span class="comment">//如果只需要指定类型的话可以直接写，如果需要其他条件，需要写成对象的形式</span></span><br><span class="line">    name:<span class="built_in">String</span>,</span><br><span class="line">    qq:&#123;</span><br><span class="line">        type:<span class="built_in">String</span>,</span><br><span class="line">        <span class="keyword">default</span>:<span class="string">&quot;740534248&quot;</span> <span class="comment">//默认</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">const</span> User = mongoose.model(<span class="string">&quot;User&quot;</span>,userSchema)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> user = <span class="keyword">new</span> User(&#123;</span><br><span class="line">    name:<span class="string">&quot;YongMaple&quot;</span></span><br><span class="line">&#125;)</span><br><span class="line">user.save()</span><br></pre></td></tr></table></figure><h3 id="指定对象的属性类型"><a href="#指定对象的属性类型" class="headerlink" title="指定对象的属性类型"></a>指定对象的属性类型</h3><ul><li><p>javascript内置类型</p><ul><li>String</li><li>Number</li><li>Boolean</li><li>Date</li><li>Array</li></ul></li><li><p>node.js内置类型</p><ul><li>Buffer</li></ul></li><li><p>mongoose特有类型</p><ul><li>Mixed</li><li>ObjectId</li></ul></li></ul><p><em><strong>举个栗子</strong></em></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> mongoose  = <span class="built_in">require</span>(<span class="string">&quot;mongoose&quot;</span>)</span><br><span class="line">mongoose.connect(<span class="string">&quot;mongodb://localhost/test&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> ObjSchema = <span class="keyword">new</span> mongoose.Schema(&#123;</span><br><span class="line">    str : <span class="built_in">String</span>,</span><br><span class="line">    num : <span class="built_in">Number</span>,</span><br><span class="line">    bool : <span class="built_in">Boolean</span>,</span><br><span class="line">    arr : <span class="built_in">Array</span>,    <span class="comment">//[]</span></span><br><span class="line">    arr2 : [<span class="built_in">Date</span>],</span><br><span class="line">    arr3 : [<span class="built_in">String</span>],</span><br><span class="line">    time : <span class="built_in">Date</span>,</span><br><span class="line"></span><br><span class="line">    buf : Buffer,</span><br><span class="line"></span><br><span class="line">    mxo : mongoose.Schema.Types.Mixed,  <span class="comment">//&#123;&#125;    混合数据类型</span></span><br><span class="line">    oid : mongoose.Schema.Types.ObjectId    <span class="comment">//唯一的</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">const</span> obj = mongoose.model(<span class="string">&quot;obj&quot;</span>,ObjSchema)</span><br><span class="line"><span class="keyword">const</span> o = <span class="keyword">new</span> obj(&#123;</span><br><span class="line">    time : <span class="keyword">new</span> <span class="built_in">Date</span>( <span class="number">42342342344</span>),  <span class="comment">//内部自动转化为Date类型，转化失败将报错</span></span><br><span class="line">    arr3 : [<span class="number">1234</span>,<span class="string">&quot;jimmy&quot;</span>,<span class="keyword">new</span> <span class="built_in">Date</span>],     <span class="comment">//内部自动转化 String</span></span><br><span class="line">    buf : <span class="keyword">new</span> Buffer([<span class="number">22</span>,<span class="number">33</span>,<span class="number">44</span>]),</span><br><span class="line"></span><br><span class="line">    oid : mongoose.Types.ObjectId()</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">o.save(<span class="function"><span class="keyword">function</span>(<span class="params">err</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(err);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="自定义类型"><a href="#自定义类型" class="headerlink" title="自定义类型"></a>自定义类型</h3><p>使用自定义类型，需要：</p><ul><li>继承mongoose.SchemaType(key,options,typeName)</li><li>重写cast(value)方法</li><li>加入mongoose.Schema.Types</li></ul><p><em><strong>举个栗子</strong></em><br>创建User.js文件</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mongoose = <span class="built_in">require</span>(<span class="string">&quot;mongoose&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//es5版</span></span><br><span class="line"><span class="comment">// function User(key,options)&#123;</span></span><br><span class="line"><span class="comment">//     mongoose.SchemaType.call(this,key,options,&quot;User&quot;)</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// User.prototype = Object.create(mongoose.SchemaType.prototype)</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// User.prototype.cast = function(val)&#123;</span></span><br><span class="line"><span class="comment">//     if(val.loginname &amp;&amp; val.password &amp;&amp; val.loginname.length &gt; 3)&#123;</span></span><br><span class="line"><span class="comment">//         return &#123;</span></span><br><span class="line"><span class="comment">//             loginname : val.loginname,</span></span><br><span class="line"><span class="comment">//             password : val.password</span></span><br><span class="line"><span class="comment">//         &#125;</span></span><br><span class="line"><span class="comment">//     &#125;else&#123;</span></span><br><span class="line"><span class="comment">//         throw new Error(&quot;user has error!&quot;)</span></span><br><span class="line"><span class="comment">//     &#125;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// mongoose.Schema.Types.User = User;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// module.exports = User;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//es6版</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">extends</span> <span class="title">mongoose</span>.<span class="title">SchemaType</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="title">constructor</span>(<span class="params">key,opts</span>)</span>&#123;</span><br><span class="line">        <span class="built_in">super</span>(key,opts,<span class="string">&quot;User&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="title">cast</span>(<span class="params">val</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(val.loginname &amp;&amp; val.password &amp;&amp; val.loginname.length &gt; <span class="number">3</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                loginname : val.loginname,</span><br><span class="line">                password : val.password</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;user has error!&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>再创建一个demo.js文件来使用上面的User.js</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mongoose = <span class="built_in">require</span>(<span class="string">&quot;mongoose&quot;</span>)</span><br><span class="line"></span><br><span class="line">mongoose.connect(<span class="string">&quot;mongodb://localhost/test&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> User = <span class="built_in">require</span>(<span class="string">&quot;./User&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> People = mongoose.model(<span class="string">&quot;People&quot;</span>,<span class="keyword">new</span> mongoose.Schema(&#123;</span><br><span class="line">    user:User</span><br><span class="line">&#125;))</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> o = <span class="keyword">new</span> People(&#123;</span><br><span class="line">    user:&#123;</span><br><span class="line">        loginname:<span class="string">&quot;jimmy&quot;</span>,</span><br><span class="line">        password:<span class="string">&quot;123456&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">o.save(<span class="function"><span class="keyword">function</span> <span class="title">callback</span>(<span class="params">err,result</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(err);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="所有类型都具有的配置"><a href="#所有类型都具有的配置" class="headerlink" title="所有类型都具有的配置"></a>所有类型都具有的配置</h3><ul><li>强制不得为空（验证器）<ul><li>required:true</li></ul></li><li>设置属性默认值<ul><li>default:”qq740534248”</li></ul></li><li>是否包括在查询结果中<ul><li>select:false</li></ul></li><li>getter 和 setter 拦截器<ul><li>get:v =&gt; v</li><li>set:v =&gt; v</li></ul></li></ul><p><em><strong>举个栗子</strong></em></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mongoose = <span class="built_in">require</span>(<span class="string">&quot;mongoose&quot;</span>)</span><br><span class="line"></span><br><span class="line">mongoose.connect(<span class="string">&quot;mongodb://localhost/test&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Obj = mongoose.model(<span class="string">&quot;Obj&quot;</span>,<span class="keyword">new</span> mongoose.Schema(&#123;</span><br><span class="line">    str:&#123;</span><br><span class="line">        type:<span class="built_in">String</span>,</span><br><span class="line">        <span class="keyword">default</span>:<span class="string">&quot;YongMaple&quot;</span>,</span><br><span class="line">        <span class="function"><span class="title">get</span>(<span class="params">v</span>)</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">`my name is <span class="subst">$&#123;v&#125;</span>`</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="function"><span class="title">set</span>(<span class="params">v</span>)</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">123</span>+v</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    loginname:&#123;</span><br><span class="line">        type:<span class="built_in">String</span>,</span><br><span class="line">        required:<span class="literal">true</span></span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    str2:&#123;</span><br><span class="line">        type:<span class="built_in">String</span>,</span><br><span class="line">        select:<span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;))</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> o = <span class="keyword">new</span> Obj(&#123;</span><br><span class="line">    str:<span class="string">&quot;Jimmy&quot;</span>,</span><br><span class="line">    str2:<span class="string">&quot;111111&quot;</span>,</span><br><span class="line">    loginname:<span class="string">&quot;333333&quot;</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="built_in">console</span>.log(o.str);     <span class="comment">//my name is 123Jimmy</span></span><br><span class="line"></span><br><span class="line">o.save(<span class="function"><span class="keyword">function</span>(<span class="params">err</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(err);</span><br><span class="line">    Obj.findOne(&#123;&#125;,<span class="function"><span class="keyword">function</span>(<span class="params">err,result</span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(result);    <span class="comment">//&#123; _id: 58993a84a184201ce8ebf5f5, __v: 0, str: &#x27;123Jimmy&#x27; &#125;</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="对属性的验证和转换"><a href="#对属性的验证和转换" class="headerlink" title="对属性的验证和转换"></a>对属性的验证和转换</h3><p><strong>验证</strong></p><ul><li>枚举<ul><li>enum:Array</li></ul></li><li>正则表达式验证<ul><li>match</li></ul></li><li>限制字符串最大和最小长度<ul><li>maxlength &amp; minlength</li></ul></li><li>Number和Date的最大最小值<ul><li>max &amp; min</li></ul></li></ul><p><strong>转换</strong></p><ul><li>字母大小写转化<ul><li>lowercase &amp; uppercase</li></ul></li><li>去除字符串前后空白字符<ul><li>trim:true/false</li></ul></li></ul><p><em><strong>举个栗子</strong></em></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mongoose =<span class="built_in">require</span>(<span class="string">&quot;mongoose&quot;</span>)</span><br><span class="line"></span><br><span class="line">mongoose.connect(<span class="string">&quot;mongodb://localhost/test&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> baseDateNum = <span class="built_in">Date</span>.now()</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Obj = mongoose.model(<span class="string">&quot;Obj&quot;</span>,<span class="keyword">new</span> mongoose.Schema(&#123;</span><br><span class="line"></span><br><span class="line">    str:&#123;</span><br><span class="line">        type:<span class="built_in">String</span>,</span><br><span class="line">        enum:[<span class="string">&quot;aaa&quot;</span>,<span class="string">&quot;bbb&quot;</span>]</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    qq:&#123;</span><br><span class="line">        type:<span class="built_in">String</span>,</span><br><span class="line">        match:<span class="regexp">/^\d*$/</span>,</span><br><span class="line">        maxlength:<span class="number">20</span>,</span><br><span class="line">        minlength:<span class="number">5</span></span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    lowerstr:&#123;</span><br><span class="line">        type:<span class="built_in">String</span>,</span><br><span class="line">        lowercase:<span class="literal">true</span></span><br><span class="line">    &#125;,</span><br><span class="line">    upperstr:&#123;</span><br><span class="line">        type:<span class="built_in">String</span>,</span><br><span class="line">        uppercase:<span class="literal">true</span></span><br><span class="line">    &#125;,</span><br><span class="line">    trimstr:&#123;</span><br><span class="line">        type:<span class="built_in">String</span>,</span><br><span class="line">        trim:<span class="literal">true</span></span><br><span class="line">    &#125;,</span><br><span class="line">    num:&#123;</span><br><span class="line">        type:<span class="built_in">Number</span>,</span><br><span class="line">        min:<span class="number">6</span>,</span><br><span class="line">        max:<span class="number">20</span></span><br><span class="line">    &#125;,</span><br><span class="line">    date:&#123;</span><br><span class="line">        type:<span class="built_in">Date</span>,</span><br><span class="line">        min:<span class="keyword">new</span> <span class="built_in">Date</span>(baseDateNum - <span class="number">1000</span>),</span><br><span class="line">        max:<span class="keyword">new</span> <span class="built_in">Date</span>(baseDateNum + <span class="number">2000</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;))</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> o = <span class="keyword">new</span> Obj(&#123;</span><br><span class="line">    str:<span class="string">&quot;bbb&quot;</span>,</span><br><span class="line">    qq:<span class="string">&quot;740534248&quot;</span>,</span><br><span class="line">    lowerstr:<span class="string">&quot;aaaAAAA&quot;</span>,</span><br><span class="line">    upperstr:<span class="string">&quot;bbbBBBB&quot;</span>,</span><br><span class="line">    trimstr:<span class="string">&quot;    aaa  aaff&quot;</span>,</span><br><span class="line">    num:<span class="number">6</span>,</span><br><span class="line">    date:<span class="keyword">new</span> <span class="built_in">Date</span>(baseDateNum+<span class="number">1000</span>)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="built_in">console</span>.log(o);</span><br><span class="line"><span class="keyword">const</span> err = o.validateSync()    <span class="comment">//同步校验，后面会讲</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(err);</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="自定义验证器"><a href="#自定义验证器" class="headerlink" title="自定义验证器"></a>自定义验证器</h3><p>有三种方式来自定义验证器</p><ul><li>validate:{ validator:Function }</li><li>Class.schema.path(xxx).validate(fn) //xxx 表示要获取的属性名，然后对其验证</li><li>validator(v,[callback])同步验证器，加入第二个参数callback变为异步验证器</li></ul><p><em><strong>举个栗子</strong></em></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mongoose = <span class="built_in">require</span>(<span class="string">&quot;mongoose&quot;</span>)</span><br><span class="line"></span><br><span class="line">mongoose.connect(<span class="string">&quot;mongodb://localhost/test&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> User = mongoose.model(<span class="string">&quot;User&quot;</span>,<span class="keyword">new</span> mongoose.Schema(&#123;</span><br><span class="line">    name:&#123;</span><br><span class="line">        type:<span class="built_in">String</span>,</span><br><span class="line">        <span class="comment">// validate:&#123;   //同步验证器，也可以是数组形式，同时多个验证器</span></span><br><span class="line">        <span class="comment">//     validator(value)&#123;</span></span><br><span class="line">        <span class="comment">//         return value.length &lt;= 9</span></span><br><span class="line">        <span class="comment">//     &#125;</span></span><br><span class="line">        <span class="comment">// &#125;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;))</span><br><span class="line"></span><br><span class="line">User.schema.path(<span class="string">&quot;name&quot;</span>).validate(<span class="function"><span class="keyword">function</span>(<span class="params">v</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> v.length &lt;= <span class="number">9</span></span><br><span class="line">&#125;)</span><br><span class="line">User.schema.path(<span class="string">&quot;name&quot;</span>).validate(<span class="function"><span class="keyword">function</span>(<span class="params">v</span>)</span>&#123;  <span class="comment">//可以加入多个</span></span><br><span class="line">    <span class="keyword">return</span> v.length &gt; <span class="number">3</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">const</span> u = <span class="keyword">new</span> User(&#123;</span><br><span class="line">    name:<span class="string">&quot;1234&quot;</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> err = u.validateSync()</span><br><span class="line"><span class="built_in">console</span>.log(err);</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><em><strong>再举个异步的栗子</strong></em></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mongoose = <span class="built_in">require</span>(<span class="string">&quot;mongoose&quot;</span>)</span><br><span class="line"></span><br><span class="line">mongoose.connect(<span class="string">&quot;mongodb://localhost/test&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> User = mongoose.model(<span class="string">&quot;User&quot;</span>,<span class="keyword">new</span> mongoose.Schema(&#123;</span><br><span class="line">    loginname:&#123;</span><br><span class="line">        type:<span class="built_in">String</span>,</span><br><span class="line">        validate:&#123;</span><br><span class="line">            <span class="function"><span class="title">validator</span>(<span class="params">value,cb</span>)</span>&#123;</span><br><span class="line">                User.findOne(&#123;<span class="attr">loginname</span>:value&#125;,<span class="function"><span class="keyword">function</span>(<span class="params">err,result</span>)</span>&#123;</span><br><span class="line">                    cb(!result)</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;))</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> user = <span class="keyword">new</span> User(&#123;</span><br><span class="line">    loginname:<span class="string">&quot;hahahaha&quot;</span></span><br><span class="line">&#125;)</span><br><span class="line">user.save(<span class="function"><span class="keyword">function</span>(<span class="params">err</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(err);   <span class="comment">//运行2遍，第二遍会抛出异常</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="获取错误信息"><a href="#获取错误信息" class="headerlink" title="获取错误信息"></a>获取错误信息</h3><ul><li>doc.validate( error =&gt; error ) <em><strong>异步获得错误信息</strong></em></li><li>error = doc.validateSync() <em><strong>获取同步错误信息</strong></em></li><li>doc.save( error =&gt; error ) <em><strong>回调获得错误信息</strong></em></li><li>promise = doc.save() <em><strong>promise方式获得错误信息</strong></em></li><li>Class.update( query , update , { runValidators:true } , callback)</li></ul><p><em><strong>举个栗子</strong></em></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mongoose = <span class="built_in">require</span>(<span class="string">&quot;mongoose&quot;</span>)</span><br><span class="line"></span><br><span class="line">mongoose.connect(<span class="string">&quot;mongodb://localhost/test&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> User = mongoose.model(<span class="string">&quot;User&quot;</span>,<span class="keyword">new</span> mongoose.Schema(&#123;</span><br><span class="line">    loginname:&#123;</span><br><span class="line">        type:<span class="built_in">String</span>,</span><br><span class="line">        required:<span class="literal">true</span>,</span><br><span class="line">        validate:&#123;</span><br><span class="line">            <span class="function"><span class="title">validator</span>(<span class="params">value,cb</span>)</span>&#123;</span><br><span class="line">                <span class="built_in">setTimeout</span>(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">                    cb(<span class="literal">false</span>)</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;))</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> u = <span class="keyword">new</span> User(&#123;</span><br><span class="line">    loginname:<span class="string">&quot;aaa11&quot;</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//1 只能获得同步</span></span><br><span class="line"><span class="keyword">const</span> err = u.validateSync()</span><br><span class="line"><span class="built_in">console</span>.log(err);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2 同步异步都能</span></span><br><span class="line"><span class="comment">// u.validate(function(err)&#123;</span></span><br><span class="line"><span class="comment">//     console.log(err);</span></span><br><span class="line"><span class="comment">// &#125;)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//3 同步异步都能  有可能是底层传上来的错误</span></span><br><span class="line"><span class="comment">// u.save(function(err)&#123;</span></span><br><span class="line"><span class="comment">//     console.log(err);</span></span><br><span class="line"><span class="comment">// &#125;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//4 同步异步都能  有可能是底层传上来的错误</span></span><br><span class="line"><span class="comment">// const promise = u.save()</span></span><br><span class="line"><span class="comment">// promise.catch(err =&gt; console.log(err))</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//5 同步异步都能  有可能是底层传上来的错误</span></span><br><span class="line"><span class="comment">// User.update(&#123;&#125;,&#123;loginname:&quot;123aaa&quot;&#125;,&#123;runValidators:true&#125;,function(err)&#123;</span></span><br><span class="line"><span class="comment">//     console.log(err);</span></span><br><span class="line"><span class="comment">// &#125;)</span></span><br></pre></td></tr></table></figure><h3 id="错误信息"><a href="#错误信息" class="headerlink" title="错误信息"></a>错误信息</h3><ul><li>err.errors <em><strong>错误集合</strong></em></li><li>err.errors.qq <em><strong>得到qq属性值的错误信息</strong></em></li><li>{ path , value , message } = err.errors.qq</li></ul><p><em><strong>举个栗子</strong></em></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mongoose = <span class="built_in">require</span>(<span class="string">&quot;mongoose&quot;</span>)</span><br><span class="line"></span><br><span class="line">mongoose.connect(<span class="string">&quot;mongodb://localhost/test&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> User = mongoose.model(<span class="string">&quot;User&quot;</span>,<span class="keyword">new</span> mongoose.Schema(&#123;</span><br><span class="line">    loginname:&#123;</span><br><span class="line">        type:<span class="built_in">String</span>,</span><br><span class="line">        required:[<span class="literal">true</span>,<span class="string">&quot;必须输入 &#123;PATH&#125; - &#123;VALUE&#125;&quot;</span>], <span class="comment">//除了enum以外所有内置验证器都是这样写</span></span><br><span class="line">        enum:&#123;<span class="attr">values</span>:[<span class="string">&quot;aaa&quot;</span>,<span class="string">&quot;bbb&quot;</span>],<span class="attr">message</span>:<span class="string">&quot;没在枚举中。。。 &#123;PATH&#125; - &#123;VALUE&#125;&quot;</span>&#125;,     <span class="comment">//枚举时，自定义错误信息比较特殊，是对象形式</span></span><br><span class="line">        validate:&#123;      <span class="comment">//自定义校验器要这样写，也是对象</span></span><br><span class="line">            <span class="function"><span class="title">validator</span>(<span class="params">value,cb</span>)</span>&#123;</span><br><span class="line">                <span class="built_in">setTimeout</span>(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">                    cb(<span class="literal">false</span>)   <span class="comment">//模拟异步错误</span></span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;,</span><br><span class="line">            message:<span class="string">&quot;校验错误 &#123;PATH&#125; - &#123;VALUE&#125;&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    password:&#123;</span><br><span class="line">        type:<span class="built_in">String</span>,</span><br><span class="line">        required:[<span class="literal">true</span>,<span class="string">&quot;密码必须填写&quot;</span>],</span><br><span class="line">        minlength:[<span class="number">6</span>,<span class="string">&quot;密码至少6位&quot;</span>]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;))</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> u = <span class="keyword">new</span> User(&#123;</span><br><span class="line">    loginname:<span class="string">&quot;aaa11&quot;</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">u.validate(<span class="function"><span class="keyword">function</span>(<span class="params">err</span>)</span>&#123;</span><br><span class="line"><span class="comment">//     const &#123;path,value,message&#125; = err.errors.loginname</span></span><br><span class="line"><span class="comment">//     console.log(path);</span></span><br><span class="line"><span class="comment">//     console.log(value);</span></span><br><span class="line"><span class="comment">//     console.log(message);</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(err &amp;&amp; err.errors)&#123;</span><br><span class="line">        <span class="keyword">const</span> keys = <span class="built_in">Object</span>.keys(err.errors)</span><br><span class="line">        <span class="keyword">let</span> str = <span class="string">&quot;&quot;</span></span><br><span class="line">        keys.map(<span class="function">(<span class="params">v,i</span>) =&gt;</span> &#123;</span><br><span class="line">            str += <span class="string">`<span class="subst">$&#123;v&#125;</span>:<span class="subst">$&#123;err.errors[v]&#125;</span>\n`</span></span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="built_in">console</span>.log(str);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//....</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>例子中<code>&#123;PATH&#125;</code>和<code>&#123;VALUE&#125;</code>是属性名和属性值</p><h3 id="加入方法"><a href="#加入方法" class="headerlink" title="加入方法"></a>加入方法</h3><ul><li>加入实例方法 schema.methods.xxx</li><li>加入静态方法 schema.statics.xxx</li><li>加入虚拟方法 getter/setter方法<ul><li>virtual(‘xxx’).get(handle)</li><li>virtual(‘xxx’).set(handle)</li></ul></li></ul><p><em><strong>举个栗子</strong></em></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mongoose = <span class="built_in">require</span>(<span class="string">&quot;mongoose&quot;</span>)</span><br><span class="line">mongoose.connect(<span class="string">&quot;mongodb://localhost/test&quot;</span>)</span><br><span class="line"><span class="keyword">const</span> userSchema = <span class="keyword">new</span> mongoose.Schema(&#123;</span><br><span class="line">    firstName: <span class="built_in">String</span>,</span><br><span class="line">    secondName: <span class="built_in">String</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//methods和statics的区别在于this是谁</span></span><br><span class="line">userSchema.methods.getAllName = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.firstName + <span class="string">&#x27;.&#x27;</span> + <span class="built_in">this</span>.secondName   <span class="comment">//这里的this指的是对象本身</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">userSchema.statics.getAll = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;             <span class="comment">//可以加入回调函数  function(cb)&#123;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.find(&#123;&#125;)     <span class="comment">//这里的this指的是User类   可以加入回调函数  this.find(&#123;&#125;,cb)</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">userSchema.virtual(<span class="string">&quot;allname&quot;</span>).get(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.firstName + <span class="string">&#x27;.&#x27;</span> + <span class="built_in">this</span>.secondName</span><br><span class="line">&#125;)  <span class="comment">//getter method</span></span><br><span class="line"></span><br><span class="line">userSchema.virtual(<span class="string">&quot;allname&quot;</span>).set(<span class="function"><span class="keyword">function</span>(<span class="params">v</span>)</span>&#123;</span><br><span class="line">    <span class="comment">//Yong.Maple</span></span><br><span class="line">    <span class="keyword">const</span> names = v.split(<span class="string">&quot;.&quot;</span>);</span><br><span class="line">    <span class="built_in">this</span>.firstName = names[<span class="number">0</span>];</span><br><span class="line">    <span class="built_in">this</span>.secondName = names[<span class="number">1</span>];</span><br><span class="line">&#125;);  <span class="comment">//setter method</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> User = mongoose.model(<span class="string">&quot;User&quot;</span>,userSchema)</span><br><span class="line"></span><br><span class="line"><span class="comment">// const u = new User(&#123;</span></span><br><span class="line"><span class="comment">//     firstName:&quot;Yong &quot;,</span></span><br><span class="line"><span class="comment">//     secondName:&quot;Maple&quot;</span></span><br><span class="line"><span class="comment">// &#125;)</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// console.log(u.getAllName());</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// User.remove(&#123;&#125;).then(()=&gt;&#123;</span></span><br><span class="line"><span class="comment">//     User.insertMany([</span></span><br><span class="line"><span class="comment">//         &#123;firstName:&quot;Yong&quot;,secondName:&quot;Maple&quot;&#125;,</span></span><br><span class="line"><span class="comment">//         &#123;firstName:&quot;Zhang&quot;,secondName:&quot;San&quot;&#125;,</span></span><br><span class="line"><span class="comment">//         &#123;firstName:&quot;Li&quot;,secondName:&quot;Si&quot;&#125;</span></span><br><span class="line"><span class="comment">//     ]).then(()=&gt;&#123;</span></span><br><span class="line"><span class="comment">//         User.getAll().then(result=&gt; console.log(result))</span></span><br><span class="line"><span class="comment">//     &#125;)</span></span><br><span class="line"><span class="comment">// &#125;)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> user = <span class="keyword">new</span> User(&#123;</span><br><span class="line">    allname:<span class="string">&quot;Yong.Maple&quot;</span></span><br><span class="line">&#125;)</span><br><span class="line">user.save()</span><br><span class="line"><span class="built_in">console</span>.log(user);</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="对象的增删改"><a href="#对象的增删改" class="headerlink" title="对象的增删改"></a>对象的增删改</h3><ul><li>obj.save / Class.create / Class.insertMany</li><li>obj.remove / Class.remove</li><li>obj.update / Class.update</li></ul><p><em><strong>举个栗子</strong></em></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mongoose = <span class="built_in">require</span>(<span class="string">&quot;mongoose&quot;</span>)</span><br><span class="line"></span><br><span class="line">mongoose.connect(<span class="string">&quot;mongodb://localhost/test&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> User = mongoose.model(<span class="string">&quot;User&quot;</span>,&#123;</span><br><span class="line">    name:&#123;<span class="attr">type</span>:<span class="built_in">String</span>,<span class="attr">maxlength</span>:<span class="number">10</span>&#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">User.remove(&#123;&#125;).then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="comment">// --------------save</span></span><br><span class="line">    <span class="comment">// const user = new User(&#123;name:&quot;JiaYongfeng&quot;&#125;)</span></span><br><span class="line">    <span class="comment">// const promise = user.save()</span></span><br><span class="line">    <span class="comment">// promise</span></span><br><span class="line">    <span class="comment">// .then(u =&gt; console.log(u))</span></span><br><span class="line">    <span class="comment">// .catch(err =&gt; console.log(err))</span></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="comment">// user.save(function (err,u)&#123;</span></span><br><span class="line">    <span class="comment">//     console.log(err,u);</span></span><br><span class="line">    <span class="comment">// &#125;)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// --------------create     成功的保存，失败的抛出异常</span></span><br><span class="line">    <span class="comment">// User.create(&#123;name:&quot;Jia&quot;&#125;,&#123;name:&quot;Yong&quot;&#125;)</span></span><br><span class="line">    <span class="comment">// .then(function(u1,u2)&#123;</span></span><br><span class="line">    <span class="comment">//     console.log(u1,u2);</span></span><br><span class="line">    <span class="comment">// &#125;).catch(err =&gt; console.log(err))</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// User.create([&#123;name:&quot;Jia&quot;&#125;,&#123;name:&quot;Yong1111&quot;&#125;])</span></span><br><span class="line">    <span class="comment">// .then(function(arr)&#123;</span></span><br><span class="line">    <span class="comment">//     console.log(arr);</span></span><br><span class="line">    <span class="comment">// &#125;).catch(err =&gt; console.log(err))</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// ------------------insertMany     必须是数组，一条失败，全部失败</span></span><br><span class="line">    <span class="comment">// User.insertMany([&#123;name:&quot;Jia&quot;&#125;,&#123;name:&quot;Yong&quot;&#125;])</span></span><br><span class="line">    <span class="comment">// .then(function(arr)&#123;</span></span><br><span class="line">    <span class="comment">//     console.log(arr);</span></span><br><span class="line">    <span class="comment">// &#125;).catch(err =&gt; console.log(err))</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// --------------------remove</span></span><br><span class="line">    <span class="comment">// User.insertMany([&#123;name:&quot;Jia22&quot;&#125;,&#123;name:&quot;Jia33&quot;&#125;,&#123;name:&quot;Jiasasd&quot;&#125;,&#123;name:&quot;Yong&quot;&#125;])</span></span><br><span class="line">    <span class="comment">// .then(function(arr)&#123;</span></span><br><span class="line">    <span class="comment">//     User.remove(&#123;name:/^Jia\d*$/&#125;).then(r =&gt; console.log(r))</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// User.remove(&#123;name:&quot;Jia&quot;&#125;).then(r =&gt; console.log(r))</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// arr[0].remove()</span></span><br><span class="line">        <span class="comment">//     .then(obj =&gt; User.create(&#123;name:obj.name + &quot; ----- reborn&quot;&#125;))</span></span><br><span class="line">        <span class="comment">//     .catch(err =&gt; console.log(err))</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// arr[0].remove(function(err,obj)&#123;</span></span><br><span class="line">        <span class="comment">//     console.log(err,obj);</span></span><br><span class="line">        <span class="comment">// &#125;)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// &#125;).catch(err =&gt; console.log(err))</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// -----------------------update</span></span><br><span class="line">    User.insertMany([&#123;<span class="attr">name</span>:<span class="string">&quot;Jia22&quot;</span>&#125;,&#123;<span class="attr">name</span>:<span class="string">&quot;Jia33&quot;</span>&#125;,&#123;<span class="attr">name</span>:<span class="string">&quot;Jiasasd&quot;</span>&#125;,&#123;<span class="attr">name</span>:<span class="string">&quot;Yong&quot;</span>&#125;])</span><br><span class="line">    .then(<span class="function"><span class="keyword">function</span>(<span class="params">arr</span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">        User.update(&#123;&#125;,&#123;<span class="attr">name</span>:<span class="string">&quot;YongFeng&quot;</span>&#125;,&#123;<span class="attr">multi</span>:<span class="literal">true</span>&#125;,<span class="function"><span class="keyword">function</span>(<span class="params">err,result</span>)</span>&#123;      <span class="comment">//默认只修改第一个符合条件的值,需要修改多个要加&#123;multi:true&#125;</span></span><br><span class="line">            <span class="built_in">console</span>.log(err,result);</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">        <span class="comment">// console.log(&quot;before update  ==&gt;&quot;,arr[0]);</span></span><br><span class="line">        <span class="comment">// arr[0].update(&#123;name:&quot;123123123123fsdsdfddfsdfdsasdas&quot;&#125;,&#123;runValidators:true&#125;).then(function(result)&#123;</span></span><br><span class="line">        <span class="comment">//     console.log(result);</span></span><br><span class="line">        <span class="comment">// &#125;).catch(err =&gt; console.log(err))</span></span><br><span class="line">    &#125;).catch(<span class="function"><span class="params">err</span> =&gt;</span> <span class="built_in">console</span>.log(err))</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="字段更改参数"><a href="#字段更改参数" class="headerlink" title="字段更改参数"></a>字段更改参数</h3><ul><li>$inc 加法运算</li><li>$mul 乘法运算</li><li>$min / $max 数值和日期的限定</li><li>$currentDate 设定当前日期</li></ul><p><em><strong>举个栗子</strong></em></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> mongoose = <span class="built_in">require</span>(<span class="string">&quot;mongoose&quot;</span>)</span><br><span class="line"></span><br><span class="line">mongoose.connect(<span class="string">&quot;mongodb://localhost/test&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> Topic = mongoose.model(<span class="string">&quot;Topic&quot;</span>, <span class="keyword">new</span> mongoose.Schema(&#123;</span><br><span class="line">    title: &#123;</span><br><span class="line">        type: <span class="built_in">String</span>,</span><br><span class="line">        required: <span class="literal">true</span></span><br><span class="line">    &#125;,</span><br><span class="line">    body: &#123;</span><br><span class="line">        type: <span class="built_in">String</span>,</span><br><span class="line">        required: <span class="literal">true</span></span><br><span class="line">    &#125;,</span><br><span class="line">    money: &#123;</span><br><span class="line">        type: <span class="built_in">Number</span>,</span><br><span class="line">        <span class="keyword">default</span>: <span class="number">0.5</span></span><br><span class="line">    &#125;,</span><br><span class="line">    accessNum: &#123;</span><br><span class="line">        type: <span class="built_in">Number</span>,</span><br><span class="line">        <span class="keyword">default</span>: <span class="number">0</span></span><br><span class="line">    &#125;,</span><br><span class="line">    createTime: <span class="built_in">Date</span>,</span><br><span class="line">    updateTime: <span class="built_in">Date</span></span><br><span class="line">&#125;))</span><br><span class="line"></span><br><span class="line">Topic.remove(&#123;&#125;, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> date = <span class="keyword">new</span> <span class="built_in">Date</span></span><br><span class="line">    <span class="keyword">var</span> topic = <span class="keyword">new</span> Topic(&#123;</span><br><span class="line">        title: <span class="string">&quot;aa&quot;</span>,</span><br><span class="line">        body: <span class="string">&quot;content&quot;</span>,</span><br><span class="line">        createTime: date,</span><br><span class="line">        updateTime: date</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    topic.save(<span class="function"><span class="keyword">function</span>(<span class="params">err, result</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">        Topic.update(&#123;&#125;, &#123;</span><br><span class="line">            title: <span class="string">&quot;my js&quot;</span>,</span><br><span class="line"></span><br><span class="line">            $currentDate:&#123;  <span class="comment">//使用当前时间修改updateTime的值</span></span><br><span class="line">                updateTime:<span class="literal">true</span></span><br><span class="line">            &#125;,</span><br><span class="line"></span><br><span class="line">            $min: &#123; <span class="comment">//最小值，和平时理解的不一样，必须小于15，不超过15变成15</span></span><br><span class="line">                accessNum: <span class="number">15</span>   <span class="comment">//15</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="comment">// $max: &#123; //最大值，和平时理解的不一样，必须大于15，不满15变成15</span></span><br><span class="line">            <span class="comment">//     accessNum: 15   //15</span></span><br><span class="line">            <span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">//每个参数只能在一个算法当中</span></span><br><span class="line">            <span class="comment">// $mul: &#123; //乘</span></span><br><span class="line">            <span class="comment">//     money: 3    //1.5</span></span><br><span class="line">            <span class="comment">// &#125;,</span></span><br><span class="line">            <span class="comment">// $inc: &#123; //加</span></span><br><span class="line">            <span class="comment">//     accessNum: 2    //2</span></span><br><span class="line">            <span class="comment">// &#125;</span></span><br><span class="line">        &#125;, <span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="数组类型字段的更改参数"><a href="#数组类型字段的更改参数" class="headerlink" title="数组类型字段的更改参数"></a>数组类型字段的更改参数</h3><ul><li>$pop 删除一条数据</li><li>$addToSet 添加去重数据</li><li>$pull / $pullAll 清除</li><li>$push 加入数据</li></ul><p><em><strong>举个栗子</strong></em></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> mongoose = <span class="built_in">require</span>(<span class="string">&quot;mongoose&quot;</span>)</span><br><span class="line"></span><br><span class="line">mongoose.connect(<span class="string">&quot;mongodb://localhost/test&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Topic = mongoose.model(<span class="string">&quot;Topic&quot;</span>, &#123;</span><br><span class="line">    arr: []</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">Topic.remove(&#123;&#125;, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    Topic.create(&#123;</span><br><span class="line">        arr: [<span class="number">11</span>, <span class="number">22</span>,<span class="number">11</span>, <span class="number">33</span>, <span class="number">44</span>, <span class="number">55</span>, <span class="number">66</span>]</span><br><span class="line">    &#125;).then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//  $pop删除一个</span></span><br><span class="line">        <span class="comment">// Topic.update(&#123;&#125;, &#123;</span></span><br><span class="line">        <span class="comment">//     $pop: &#123;</span></span><br><span class="line">        <span class="comment">//         arr: 1  //[11, 22, 33, 44, 55]  正数从后往前，负数从前往后</span></span><br><span class="line">        <span class="comment">//         //arr: -1 //[ 22, 33, 44, 55, 66]</span></span><br><span class="line">        <span class="comment">//     &#125;</span></span><br><span class="line">        <span class="comment">// &#125;).exec()</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//  $addToSet添加不重复</span></span><br><span class="line">        <span class="comment">// Topic.update(&#123;&#125;, &#123;</span></span><br><span class="line">        <span class="comment">//     $addToSet: &#123;</span></span><br><span class="line">        <span class="comment">//         // arr: 66     //如果重复，无法添加</span></span><br><span class="line">        <span class="comment">//         // arr: [77,88]    //[11, 22, 33, 44, 55, 66, [77,88]]并不是预期的效果</span></span><br><span class="line">        <span class="comment">//         arr: &#123;</span></span><br><span class="line">        <span class="comment">//             $each: [77, 88]     //[ 11, 22, 33, 44, 55, 66, 77, 88 ]</span></span><br><span class="line">        <span class="comment">//         &#125;</span></span><br><span class="line">        <span class="comment">//     &#125;</span></span><br><span class="line">        <span class="comment">// &#125;).exec()</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//  $pull删除一种数据</span></span><br><span class="line">        <span class="comment">// Topic.update(&#123;&#125;,&#123;</span></span><br><span class="line">        <span class="comment">//     $pull:&#123;</span></span><br><span class="line">        <span class="comment">//         arr:11  //[ 22, 33, 44, 55, 66 ]</span></span><br><span class="line">        <span class="comment">//         // arr:[11,22] //无效的</span></span><br><span class="line">        <span class="comment">//     &#125;</span></span><br><span class="line">        <span class="comment">// &#125;).exec()</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//  $pullAll删除多种数据</span></span><br><span class="line">        <span class="comment">// Topic.update(&#123;&#125;,&#123;</span></span><br><span class="line">        <span class="comment">//     $pullAll:&#123;</span></span><br><span class="line">        <span class="comment">//         arr:[11,22]  //[ 33, 44, 55, 66 ]</span></span><br><span class="line">        <span class="comment">//     &#125;</span></span><br><span class="line">        <span class="comment">// &#125;).exec()</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//  $push添加数据，可以重复</span></span><br><span class="line">        Topic.update(&#123;&#125;,&#123;</span><br><span class="line">            $push:&#123;</span><br><span class="line">                <span class="comment">// arr:66  //[ 11, 22, 11, 33, 44, 55, 66, 66 ]</span></span><br><span class="line">                arr:&#123;</span><br><span class="line">                    $each: [<span class="number">77</span>, <span class="number">88</span>],</span><br><span class="line">                    $position:<span class="number">0</span>,     <span class="comment">//从指定位置开始添加[ 77, 88, 11, 22, 11, 33, 44, 55, 66 ]</span></span><br><span class="line">                    $slice:-<span class="number">3</span>        <span class="comment">//截取数组，正数从前截取，负数从后截取</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).exec()</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="对象的基础查询"><a href="#对象的基础查询" class="headerlink" title="对象的基础查询"></a>对象的基础查询</h3><ul><li>find(conditions , [projection] , [options] , [callback])</li><li>findById</li><li>findByIdAndRemove / findByIdAndUpdate</li><li>findOne</li><li>findOneAndRemove / findOneAndUpdate</li></ul><p><em><strong>举个栗子</strong></em></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> mongoose = <span class="built_in">require</span>(<span class="string">&quot;mongoose&quot;</span>)</span><br><span class="line">mongoose.connect(<span class="string">&quot;mongodb://localhost/test&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Topic = mongoose.model(<span class="string">&quot;Topic&quot;</span>, &#123;</span><br><span class="line">    name: &#123;</span><br><span class="line">        type: <span class="built_in">String</span>,</span><br><span class="line">        maxlength: <span class="number">10</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> arr = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">50</span>; i++) &#123;</span><br><span class="line">    arr.push(&#123;</span><br><span class="line">        name: <span class="string">&quot;Jimmy&quot;</span> + i</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line">Topic.remove(&#123;&#125;, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    Topic.create(arr).then(<span class="function"><span class="keyword">function</span>(<span class="params">objs</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">let</span> id = objs[<span class="number">0</span>].id</span><br><span class="line">        <span class="comment">// Topic.findById(id, function(err, t) &#123;</span></span><br><span class="line">        <span class="comment">//     console.log(t);</span></span><br><span class="line">        <span class="comment">// &#125;)</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// Topic.findByIdAndRemove(id, function(err, t) &#123;</span></span><br><span class="line">        <span class="comment">//     console.log(t);</span></span><br><span class="line">        <span class="comment">// &#125;)</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// Topic.findByIdAndUpdate(id, &#123;</span></span><br><span class="line">        <span class="comment">//     name: &quot;hahahaha111111111&quot;</span></span><br><span class="line">        <span class="comment">// &#125;, &#123;</span></span><br><span class="line">        <span class="comment">//     runValidators: true</span></span><br><span class="line">        <span class="comment">// &#125;, function(err, t) &#123;</span></span><br><span class="line">        <span class="comment">//     console.log(err, t);</span></span><br><span class="line">        <span class="comment">// &#125;)</span></span><br><span class="line">        <span class="comment">// 上面这个和这个一样的效果</span></span><br><span class="line">        <span class="comment">// Topic.findByIdAndUpdate(id, &#123;</span></span><br><span class="line">        <span class="comment">//     name: &quot;hahahaha111111111&quot;</span></span><br><span class="line">        <span class="comment">// &#125;, &#123;</span></span><br><span class="line">        <span class="comment">//     runValidators: true</span></span><br><span class="line">        <span class="comment">// &#125;).then(function(t) &#123;</span></span><br><span class="line">        <span class="comment">//     console.log(t);</span></span><br><span class="line">        <span class="comment">// &#125;).catch(err =&gt; console.log(err))</span></span><br><span class="line">        <span class="comment">// 效果还是一样的，错误交由外部处理</span></span><br><span class="line">        <span class="comment">// return Topic.findByIdAndUpdate(id, &#123;</span></span><br><span class="line">        <span class="comment">//     name: &quot;hahahaha111111111&quot;</span></span><br><span class="line">        <span class="comment">// &#125;, &#123;</span></span><br><span class="line">        <span class="comment">//     runValidators: true</span></span><br><span class="line">        <span class="comment">// &#125;).then(function(t) &#123;</span></span><br><span class="line">        <span class="comment">//     console.log(t);</span></span><br><span class="line">        <span class="comment">// &#125;)</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// Topic.findOne(&#123;name:/^Jimmy1\d$/&#125;,function(err,t)&#123;  //返回满足条件的第一个</span></span><br><span class="line">        <span class="comment">//     console.log(t);</span></span><br><span class="line">        <span class="comment">// &#125;)</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// Topic.find(&#123;&#125;,function(err,ts)&#123;</span></span><br><span class="line">        <span class="comment">//     console.log(ts);</span></span><br><span class="line">        <span class="comment">// &#125;)</span></span><br><span class="line">        <span class="comment">// Topic.find(&#123;name:/^Jimmy1\d$/&#125;,function(err,ts)&#123;</span></span><br><span class="line">        <span class="comment">//     console.log(ts);</span></span><br><span class="line">        <span class="comment">// &#125;)</span></span><br><span class="line">        <span class="comment">// Topic.find(&#123;name:/^Jimmy1\d$/&#125;,&quot;_id name&quot;,function(err,ts)&#123;  //第二个参数决定返回结果带有的属性，用空格分割，如果在属性前加-，则表示不返回这个属性</span></span><br><span class="line">        <span class="comment">//     console.log(ts);</span></span><br><span class="line">        <span class="comment">// &#125;)</span></span><br><span class="line">        Topic.find(&#123;<span class="attr">name</span>:<span class="regexp">/^Jimmy1\d$/</span>&#125;,<span class="literal">null</span>,&#123;<span class="attr">skip</span>:<span class="number">5</span>,<span class="attr">limit</span>:<span class="number">3</span>&#125;,<span class="function"><span class="keyword">function</span>(<span class="params">err,ts</span>)</span>&#123; <span class="comment">//第三个参数是对结果的筛选，skip指跳过几个，limit指最多返回几个，结合这两个可以实现翻页功能</span></span><br><span class="line">            <span class="built_in">console</span>.log(ts);</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">    &#125;).catch(<span class="function"><span class="params">err</span> =&gt;</span> <span class="built_in">console</span>.log(err))</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="比较式查询"><a href="#比较式查询" class="headerlink" title="比较式查询"></a>比较式查询</h3><ul><li>大小判断<ul><li>$eq 等于</li><li>$gt 大于</li><li>$gte 大于等于</li><li>$lt 小于</li><li>$lte 小于等于</li></ul></li><li>$ne 不是</li><li>$in 包含</li><li>$nin 不包含</li></ul><p><em><strong>举个栗子</strong></em></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> mongoose = <span class="built_in">require</span>(<span class="string">&quot;mongoose&quot;</span>)</span><br><span class="line">mongoose.connect(<span class="string">&quot;mongodb://localhost/test&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Topic = mongoose.model(<span class="string">&quot;Topic&quot;</span>, &#123;</span><br><span class="line">    name: &#123;</span><br><span class="line">        type: <span class="built_in">String</span>,</span><br><span class="line">        maxlength: <span class="number">10</span></span><br><span class="line">    &#125;,</span><br><span class="line">    num: <span class="built_in">Number</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> arr = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">50</span>; i++) &#123;</span><br><span class="line">    arr.push(&#123;</span><br><span class="line">        name: <span class="string">&quot;Jimmy&quot;</span> + i,</span><br><span class="line">        num: i</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line">Topic.remove(&#123;&#125;, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    Topic.create(arr).then(<span class="function"><span class="keyword">function</span>(<span class="params">objs</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">        Topic.find(&#123;</span><br><span class="line">            num: &#123;</span><br><span class="line">                <span class="comment">// $lt: 20,    //小于20</span></span><br><span class="line">                <span class="comment">// $lte:20,    //小于等于20</span></span><br><span class="line">                <span class="comment">// $gt:10,      //大于10</span></span><br><span class="line">                <span class="comment">// $gte:10,     //大于等于10</span></span><br><span class="line">                <span class="comment">// $in: [11, 15], //值等于11或15</span></span><br><span class="line">                <span class="comment">// $nin: [11, 15], //值不等于11或15</span></span><br><span class="line">                <span class="comment">// $ne: 2, //不等于2的，只能一个值</span></span><br><span class="line">                $eq: <span class="number">2</span>, <span class="comment">//等于2的</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="function"><span class="keyword">function</span>(<span class="params">err, ts</span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(ts);</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="逻辑式查询"><a href="#逻辑式查询" class="headerlink" title="逻辑式查询"></a>逻辑式查询</h3><ul><li>$or 或</li><li>$nor ($or相反)</li><li>$and 和</li><li>$not 否</li></ul><p><em><strong>举个栗子</strong></em></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> mongoose = <span class="built_in">require</span>(<span class="string">&quot;mongoose&quot;</span>)</span><br><span class="line">mongoose.connect(<span class="string">&quot;mongodb://localhost/test&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> Topic = mongoose.model(<span class="string">&quot;Topic&quot;</span>, &#123;</span><br><span class="line">    name: &#123;</span><br><span class="line">        type: <span class="built_in">String</span>,</span><br><span class="line">        maxlength: <span class="number">10</span></span><br><span class="line">    &#125;,</span><br><span class="line">    num: <span class="built_in">Number</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> arr = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">50</span>; i++) &#123;</span><br><span class="line">    arr.push(&#123;</span><br><span class="line">        name: <span class="string">&quot;Jimmy&quot;</span> + i,</span><br><span class="line">        num: i</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line">Topic.remove(&#123;&#125;, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    Topic.create(arr).then(<span class="function"><span class="keyword">function</span>(<span class="params">objs</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">        Topic.find(&#123;</span><br><span class="line">            <span class="comment">// $or: [&#123;     //满足一个条件就会返回</span></span><br><span class="line">            <span class="comment">//     name: &quot;Jimmy1&quot;</span></span><br><span class="line">            <span class="comment">// &#125;, &#123;</span></span><br><span class="line">            <span class="comment">//     num: 4</span></span><br><span class="line">            <span class="comment">// &#125;,&#123;</span></span><br><span class="line">            <span class="comment">//     num: 6</span></span><br><span class="line">            <span class="comment">// &#125;]</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">// $nor: [&#123;        //不满足所有条件就返回</span></span><br><span class="line">            <span class="comment">//     name: &quot;Jimmy1&quot;</span></span><br><span class="line">            <span class="comment">// &#125;, &#123;</span></span><br><span class="line">            <span class="comment">//     num: 4</span></span><br><span class="line">            <span class="comment">// &#125;, &#123;</span></span><br><span class="line">            <span class="comment">//     num: 6</span></span><br><span class="line">            <span class="comment">// &#125;]</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">// $and: [&#123;        //满足所有条件才返回</span></span><br><span class="line">            <span class="comment">//     name: /^Jimmy1\d$/</span></span><br><span class="line">            <span class="comment">// &#125;, &#123;</span></span><br><span class="line">            <span class="comment">//     num: &#123;</span></span><br><span class="line">            <span class="comment">//         $lte:15</span></span><br><span class="line">            <span class="comment">//     &#125;</span></span><br><span class="line">            <span class="comment">// &#125;]</span></span><br><span class="line">            <span class="comment">// $and: [&#123;        //可以混合使用</span></span><br><span class="line">            <span class="comment">//     $or: [&#123;</span></span><br><span class="line">            <span class="comment">//         name: &quot;Jimmy1&quot;</span></span><br><span class="line">            <span class="comment">//     &#125;, &#123;</span></span><br><span class="line">            <span class="comment">//         num: 4</span></span><br><span class="line">            <span class="comment">//     &#125;, &#123;</span></span><br><span class="line">            <span class="comment">//         num: 6</span></span><br><span class="line">            <span class="comment">//     &#125;]</span></span><br><span class="line">            <span class="comment">// &#125;, &#123;</span></span><br><span class="line">            <span class="comment">//     num: 4</span></span><br><span class="line">            <span class="comment">// &#125;]</span></span><br><span class="line"></span><br><span class="line">            num: &#123;</span><br><span class="line">                $not: &#123; <span class="comment">//不满足条件的返回</span></span><br><span class="line">                    $gte: <span class="number">10</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;, <span class="function"><span class="keyword">function</span>(<span class="params">err, ts</span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(ts);</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="数组专用查询"><a href="#数组专用查询" class="headerlink" title="数组专用查询"></a>数组专用查询</h3><ul><li>$all 是否包含查询条件</li><li>$elemMatch 数组元素查询条件</li><li>$size 数组大小查询条件</li><li>$where 其他</li></ul><p><em><strong>举个栗子</strong></em></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> mongoose = <span class="built_in">require</span>(<span class="string">&quot;mongoose&quot;</span>)</span><br><span class="line">mongoose.connect(<span class="string">&quot;mongodb://localhost/test&quot;</span>)</span><br><span class="line"><span class="comment">//$all&amp;$elemMatch</span></span><br><span class="line"><span class="comment">// const Topic = mongoose.model(&quot;Topic&quot;, &#123;</span></span><br><span class="line"><span class="comment">//     arr: []</span></span><br><span class="line"><span class="comment">// &#125;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//$all</span></span><br><span class="line"><span class="comment">// Topic.remove(&#123;&#125;, function() &#123;</span></span><br><span class="line"><span class="comment">//     Topic.create([&#123;</span></span><br><span class="line"><span class="comment">//             arr: [11, 22, 33]</span></span><br><span class="line"><span class="comment">//         &#125;,</span></span><br><span class="line"><span class="comment">//         &#123;</span></span><br><span class="line"><span class="comment">//             arr: [33, 44, 55]</span></span><br><span class="line"><span class="comment">//         &#125;,</span></span><br><span class="line"><span class="comment">//         &#123;</span></span><br><span class="line"><span class="comment">//             arr: [55, 66, 77, 88]</span></span><br><span class="line"><span class="comment">//         &#125;</span></span><br><span class="line"><span class="comment">//     ]).then(function() &#123;</span></span><br><span class="line"><span class="comment">//         Topic.find(&#123;</span></span><br><span class="line"><span class="comment">//             arr: &#123;</span></span><br><span class="line"><span class="comment">//                 $all: [33, 44] //都存在的返回</span></span><br><span class="line"><span class="comment">//             &#125;</span></span><br><span class="line"><span class="comment">//         &#125;).then((result) =&gt; &#123;</span></span><br><span class="line"><span class="comment">//             console.log(result);</span></span><br><span class="line"><span class="comment">//         &#125;)</span></span><br><span class="line"><span class="comment">//     &#125;)</span></span><br><span class="line"><span class="comment">// &#125;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//$elemMatch</span></span><br><span class="line"><span class="comment">// function generatorArr(size) &#123;</span></span><br><span class="line"><span class="comment">//     let arr = []</span></span><br><span class="line"><span class="comment">//     for (let i = 0; i &lt; size; i++) &#123;</span></span><br><span class="line"><span class="comment">//         arr.push(&#123;</span></span><br><span class="line"><span class="comment">//             name: &quot;Jimmy&quot; + i,</span></span><br><span class="line"><span class="comment">//             num: i</span></span><br><span class="line"><span class="comment">//         &#125;)</span></span><br><span class="line"><span class="comment">//     &#125;</span></span><br><span class="line"><span class="comment">//     return arr</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Topic.remove(&#123;&#125;, function() &#123;</span></span><br><span class="line"><span class="comment">//     Topic.create([&#123;</span></span><br><span class="line"><span class="comment">//             arr: generatorArr(5)</span></span><br><span class="line"><span class="comment">//         &#125;,</span></span><br><span class="line"><span class="comment">//         &#123;</span></span><br><span class="line"><span class="comment">//             arr: generatorArr(10)</span></span><br><span class="line"><span class="comment">//         &#125;,</span></span><br><span class="line"><span class="comment">//         &#123;</span></span><br><span class="line"><span class="comment">//             arr: generatorArr(15)</span></span><br><span class="line"><span class="comment">//         &#125;</span></span><br><span class="line"><span class="comment">//     ]).then(function() &#123;</span></span><br><span class="line"><span class="comment">//         Topic.find(&#123;</span></span><br><span class="line"><span class="comment">//             arr: &#123;</span></span><br><span class="line"><span class="comment">//                 // $elemMatch: &#123;       //匹配数组内部元素的数据</span></span><br><span class="line"><span class="comment">//                 //     name: &quot;Jimmy9&quot;</span></span><br><span class="line"><span class="comment">//                 // &#125;</span></span><br><span class="line"><span class="comment">//                 $size: 5        //匹配数组length</span></span><br><span class="line"><span class="comment">//             &#125;</span></span><br><span class="line"><span class="comment">//         &#125;).then((result) =&gt; &#123;</span></span><br><span class="line"><span class="comment">//             console.log(result);</span></span><br><span class="line"><span class="comment">//         &#125;)</span></span><br><span class="line"><span class="comment">//     &#125;)</span></span><br><span class="line"><span class="comment">// &#125;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//$where</span></span><br><span class="line"><span class="keyword">const</span> Topic = mongoose.model(<span class="string">&quot;Topic&quot;</span>, &#123;</span><br><span class="line">    obj: &#123;&#125;</span><br><span class="line">&#125;)</span><br><span class="line">Topic.remove(&#123;&#125;, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    Topic.create([&#123;</span><br><span class="line">        obj: &#123;</span><br><span class="line">            name: <span class="string">&quot;java&quot;</span>,</span><br><span class="line">            num: <span class="number">1</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, &#123;</span><br><span class="line">        obj: &#123;</span><br><span class="line">            name: <span class="string">&quot;javascript&quot;</span>,</span><br><span class="line">            num: <span class="number">2</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, &#123;</span><br><span class="line">        obj: &#123;</span><br><span class="line">            name: <span class="string">&quot;nodejs&quot;</span>,</span><br><span class="line">            num: <span class="number">3</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;]).then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        Topic.find(&#123;</span><br><span class="line">            <span class="comment">// $where: &quot;this.obj.name === &#x27;java&#x27;&quot;      //直接写js</span></span><br><span class="line">            $where: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="regexp">/^java\w*$/</span>.test(<span class="built_in">this</span>.obj.name) &amp;&amp; <span class="built_in">this</span>.obj.num === <span class="number">2</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="literal">null</span>, &#123; <span class="comment">//同样可以混合使用</span></span><br><span class="line">            limit: <span class="number">2</span>,</span><br><span class="line">            skip: <span class="number">0</span></span><br><span class="line">        &#125;).then(<span class="function"><span class="keyword">function</span>(<span class="params">result</span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(result);</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="Query查询风格"><a href="#Query查询风格" class="headerlink" title="Query查询风格"></a>Query查询风格</h3><p>另一种风格的写法，作为了解，下面例子将会改写上面的例子<br><em><strong>举个栗子</strong></em></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">Topic.create([&#123;</span><br><span class="line">        arr: [<span class="number">11</span>, <span class="number">22</span>, <span class="number">33</span>]</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        arr: [<span class="number">33</span>, <span class="number">44</span>, <span class="number">55</span>]</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        arr: [<span class="number">55</span>, <span class="number">66</span>, <span class="number">77</span>, <span class="number">88</span>]</span><br><span class="line">    &#125;</span><br><span class="line">]).then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> query = Topic.find()</span><br><span class="line">    query.where(<span class="string">&quot;arr&quot;</span>)</span><br><span class="line">        .all([<span class="number">33</span>,<span class="number">44</span>])</span><br><span class="line">        .limit(<span class="number">3</span>)</span><br><span class="line">        .skip(<span class="number">10</span>)</span><br><span class="line">        .select(<span class="string">&quot;name age&quot;</span>)</span><br><span class="line">        .exec(<span class="function"><span class="keyword">function</span> (<span class="params">err,result</span>)</span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(result)</span><br><span class="line">        &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">//elemMatch的query写法</span></span><br><span class="line">Topic.create([&#123;</span><br><span class="line">        arr: generatorArr(<span class="number">5</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        arr: generatorArr(<span class="number">10</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        arr: generatorArr(<span class="number">15</span>)</span><br><span class="line">    &#125;</span><br><span class="line">]).then(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    Topic.find()</span><br><span class="line">    .where(<span class="string">&quot;arr&quot;</span>)</span><br><span class="line">    .elemMatch(&#123;<span class="attr">name</span>:<span class="string">&quot;Jimmy9&quot;</span>&#125;)</span><br><span class="line">    .exec(<span class="function"><span class="keyword">function</span> (<span class="params">err,result</span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(result)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment">//另一种写法</span></span><br><span class="line">    Topic.find()</span><br><span class="line">    .where(<span class="string">&quot;arr&quot;</span>)</span><br><span class="line">    .elemMatch(<span class="function"><span class="keyword">function</span> (<span class="params">elem</span>)</span>&#123;</span><br><span class="line">        elem.where(<span class="string">&quot;name&quot;</span>).eq(<span class="string">&quot;Jimmy9&quot;</span>).where(<span class="string">&quot;num&quot;</span>).gte() ....</span><br><span class="line">    &#125;)</span><br><span class="line">    .exec(<span class="function"><span class="keyword">function</span> (<span class="params">err,result</span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(result)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>具体可以查看文档<a target="_blank" rel="noopener" href="http://mongoosejs.com/docs/queries.html">http://mongoosejs.com/docs/queries.html</a></p><h3 id="中间件"><a href="#中间件" class="headerlink" title="中间件"></a>中间件</h3><p>会触发中间件的：</p><ul><li>validate</li><li>doc.save</li><li>Class.create / Class.insertMany</li><li>doc.update</li><li>doc.remove</li><li>find</li><li>findOne</li><li>findAndRemove / findOneAndUpdate</li></ul><p><em><strong>举个栗子</strong></em></p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> mongoose = <span class="built_in">require</span>(<span class="string">&quot;mongoose&quot;</span>)</span><br><span class="line"></span><br><span class="line">mongoose.connect(<span class="string">&quot;mongodb://localhost/test&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> userSchema = <span class="keyword">new</span> mongoose.Schema(&#123;</span><br><span class="line">    name: &#123;</span><br><span class="line">        type: <span class="built_in">String</span>,</span><br><span class="line">        maxlength: <span class="number">5</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line">userSchema.pre(<span class="string">&quot;validate&quot;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">next</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;pre validate&quot;</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="built_in">this</span>.errors);</span><br><span class="line">    next()</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">userSchema.post(<span class="string">&quot;validate&quot;</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// console.log(this.errors?this.errors.name.message:this.errors);</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;post validate&quot;</span>);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// userSchema.pre(&quot;save&quot;, function(next) &#123;</span></span><br><span class="line"><span class="comment">//     console.log(&quot;pre save one&quot;);</span></span><br><span class="line"><span class="comment">//     next()</span></span><br><span class="line"><span class="comment">// &#125;)</span></span><br><span class="line">userSchema.pre(<span class="string">&quot;save&quot;</span>,<span class="literal">true</span>, <span class="function"><span class="keyword">function</span>(<span class="params">next,done</span>) </span>&#123;    <span class="comment">//默认不加true，加true表示并行,在执行完所有的pre之后在执行后面的，没什么卵用的功能，完全能用next来控制</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;pre save one&quot;</span>);</span><br><span class="line">    next()</span><br><span class="line">    <span class="built_in">setTimeout</span>(done,<span class="number">2000</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">userSchema.pre(<span class="string">&quot;save&quot;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">next</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;pre save two&quot;</span>);</span><br><span class="line">    <span class="built_in">setTimeout</span>(next,<span class="number">2000</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">userSchema.post(<span class="string">&quot;save&quot;</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;post save&quot;</span>);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">userSchema.pre(<span class="string">&quot;update&quot;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">next</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;pre update&quot;</span>);</span><br><span class="line">    next()</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">userSchema.post(<span class="string">&quot;update&quot;</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;post update&quot;</span>);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">userSchema.pre(<span class="string">&quot;remove&quot;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">next</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;pre remove&quot;</span>);</span><br><span class="line">    next()</span><br><span class="line">&#125;)</span><br><span class="line">userSchema.post(<span class="string">&quot;remove&quot;</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;post remove&quot;</span>);</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">const</span> User = mongoose.model(<span class="string">&quot;User&quot;</span>, userSchema)</span><br><span class="line"></span><br><span class="line">User.remove(&#123;&#125;, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> user = <span class="keyword">new</span> User(&#123;</span><br><span class="line">        name: <span class="string">&quot;Jia&quot;</span></span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    user.save(<span class="function"><span class="keyword">function</span>(<span class="params">err, u</span>) </span>&#123;</span><br><span class="line">        u.update(&#123;</span><br><span class="line">            name: <span class="string">&quot;Jimmy&quot;</span></span><br><span class="line">        &#125;).then(<span class="function"><span class="keyword">function</span>(<span class="params">result</span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">            u.remove()</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><em><strong>END</strong></em></p></div><div id="donate"><link rel="stylesheet" type="text/css" href="/css/donate.css"><script type="text/javascript" src="/js/donate.js" successtext="复制成功!"></script><a class="pos-f tr3" id="github" target="_blank" rel="noopener" href="https://github.com/YongMaple" arget="_blank" title="Github"></a><div id="DonateText">Donate</div><ul class="list pos-f" id="donateBox"><li id="AliPay" qr="/img/AliPayQR.jpg"></li><li id="WeChat" qr="/img/WeChatQR.jpg"></li></ul><div class="pos-f left-100" id="QRBox"><div id="MainBox"></div></div></div><script type="text/javascript" src="/js/share.js?v=1.0.0" async></script><a class="article-share-link" data-url="https://yongmaple.com/2017/02/07/Mongoose%E5%85%A5%E9%97%A8/" data-id="cknh2nne3002q4fqgen0e3kr6" data-qrcode="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAACKUlEQVR42u3a227CQAxFUf7/p9NXJMiwjx1Q49nzhChtvKhkjS+PBz7H0zl75/X9158+f+bs9dlvXXBkyJBxW8axPOvgSLhnQRM8iU2GDBn7MHha7Dy4xljHJkOGDBkpifxl/lsyZMiQ0Um4a1IchAwZMmQABiliSbqspdef1uIyZMi4IYMH8fvXX5lvyJAh41aMIzxpokyHmrUjQ4aM2Qye4NLlic4AoBiPDBkyhjI6w8XaIJO06uJPypAhYzNGenVbB1G7YqYLHzJkyJjN6CxMpMODzvJZsfUmQ4aM0Yz0CshhnaEpgsmQIWMc46p0yccGaQJFPBkyZGzA4OVo7TO8cZZeDd/U4jJkyBjHqKVI3hTrF7ppopchQ8Y8Bl9x6ISeFsMxWIYMGaMZHMCb+7XWW9pikyFDxj6MdLiYNvFrgfLFiw+1uAwZMsYx1lc9finsjzYf6ZEhQ8Y2jLRLd1URm5LePFeGDBmjGTzc2nhgndD5chj/mmTIkDGV0Q8xLT6vGhicTjlkyJAxmsGTJi93a8sW5LkyZMjYjZG2/jsLZOloAd1tZciQMZRxhIc8ptZW41fP+P8gQ4aMmzO+MSXsrJd1xqIyZMiYzahdDdPHc3YtTcuQIWMHRj8s8g75CopIGTJkyMCrEiTEzh32Q0UuQ4YMGaV2GL9ikoHlFxOuDBky/j2DFLFp0Omwk5e+MmTI2I2RFplkCYOXoHzh7IKhpgwZMu7H+AN2fpNhUX3i2wAAAABJRU5ErkJggg==">分享</a><div class="tags"><a href="/tags/mongodb/"><i class="fa fa-tag"></i>mongodb</a><a href="/tags/mongoose/"><i class="fa fa-tag"></i>mongoose</a></div><div class="post-nav"><a class="pre" href="/2017/02/09/%E4%B8%80%E5%B0%8F%E6%97%B6%E5%85%A5%E9%97%A8Vue/">一小时入门Vue</a><a class="next" href="/2017/02/04/IOS%E8%AE%BE%E7%BD%AEdocument-title%E6%97%A0%E6%95%88%E7%9A%84%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95/">IOS设置document.title无效的解决办法</a></div><div id="vcomment"></div><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine@latest/dist/Valine.min.js"></script><script>var notify=!1,verify=!1,GUEST_INFO=["nick","mail","link"],guest_info="nick,mail,link".split(",").filter(function(i){return-1<GUEST_INFO.indexOf(i)});guest_info=0==guest_info.length?GUEST_INFO:guest_info,window.valine=new Valine({el:"#vcomment",notify:notify,verify:verify,appId:"I3xP7RQ9tkxTDanFl9uqQVz5-gzGzoHsz",appKey:"ES3vn5QS7Nr60OgnmwKqCkv9",placeholder:"写点什么吧",avatar:"retro",guest_info:guest_info,pageSize:"10"})</script></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.baidu.com/baidu" method="get" accept-charset="utf-8" target="_blank"><input type="search" name="word" maxlength="20" placeholder="Search"><input type="hidden" name="si" value="https://yongmaple.com"><input name="tn" type="hidden" value="bds"><input name="cl" type="hidden" value="3"><input name="ct" type="hidden" value="2097152"><input name="s" type="hidden" value="on"></form></div><div class="widget"><div class="widget-title"> <i class="fa fa-folder-o">分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%85%B6%E4%BB%96/">其他</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%89%8D%E7%AB%AF/">前端</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%90%8E%E7%AB%AF/">后端</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%B7%A5%E5%85%B7/">工具</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%80%9D%E7%BB%B4/">思维</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%8A%A5%E9%94%99/">报错</a></li></ul></div><div class="widget"><div class="widget-title"> <i class="fa fa-star-o">标签</i></div><div class="tagcloud"><a href="/tags/AntD/" style="font-size:15px">AntD</a> <a href="/tags/AntV/" style="font-size:15px">AntV</a> <a href="/tags/L7/" style="font-size:15px">L7</a> <a href="/tags/Atom/" style="font-size:15px">Atom</a> <a href="/tags/eslint/" style="font-size:15px">eslint</a> <a href="/tags/%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/" style="font-size:15px">开发工具</a> <a href="/tags/%E9%85%8D%E7%BD%AE/" style="font-size:15px">配置</a> <a href="/tags/css/" style="font-size:15px">css</a> <a href="/tags/Oh-My-ZSH/" style="font-size:15px">Oh-My-ZSH</a> <a href="/tags/CentOS/" style="font-size:15px">CentOS</a> <a href="/tags/egg-js/" style="font-size:15px">egg.js</a> <a href="/tags/redis/" style="font-size:15px">redis</a> <a href="/tags/Cesium/" style="font-size:15px">Cesium</a> <a href="/tags/ES6/" style="font-size:15px">ES6</a> <a href="/tags/ESlint/" style="font-size:15px">ESlint</a> <a href="/tags/title/" style="font-size:15px">title</a> <a href="/tags/ios/" style="font-size:15px">ios</a> <a href="/tags/%E6%89%8B%E6%9C%BA%E7%AB%AF/" style="font-size:15px">手机端</a> <a href="/tags/JavaScript/" style="font-size:15px">JavaScript</a> <a href="/tags/JS/" style="font-size:15px">JS</a> <a href="/tags/%E5%9F%BA%E7%A1%80/" style="font-size:15px">基础</a> <a href="/tags/%E8%BD%AC%E6%8D%A2/" style="font-size:15px">转换</a> <a href="/tags/%E5%8F%82%E6%95%B0/" style="font-size:15px">参数</a> <a href="/tags/forEach/" style="font-size:15px">forEach</a> <a href="/tags/map/" style="font-size:15px">map</a> <a href="/tags/includes/" style="font-size:15px">includes</a> <a href="/tags/indexOf/" style="font-size:15px">indexOf</a> <a href="/tags/%E6%95%B0%E7%BB%84/" style="font-size:15px">数组</a> <a href="/tags/%E6%8B%BC%E6%8E%A5/" style="font-size:15px">拼接</a> <a href="/tags/match/" style="font-size:15px">match</a> <a href="/tags/exec/" style="font-size:15px">exec</a> <a href="/tags/%E6%AD%A3%E5%88%99/" style="font-size:15px">正则</a> <a href="/tags/sort/" style="font-size:15px">sort</a> <a href="/tags/%E6%AF%94%E8%BE%83/" style="font-size:15px">比较</a> <a href="/tags/%E6%8E%92%E5%BA%8F/" style="font-size:15px">排序</a> <a href="/tags/%E6%BA%90%E4%BB%A3%E7%A0%81%E6%9F%A5%E7%9C%8B/" style="font-size:15px">源代码查看</a> <a href="/tags/nodejs/" style="font-size:15px">nodejs</a> <a href="/tags/Mac/" style="font-size:15px">Mac</a> <a href="/tags/%E8%BE%93%E5%85%A5%E6%B3%95/" style="font-size:15px">输入法</a> <a href="/tags/mongodb/" style="font-size:15px">mongodb</a> <a href="/tags/mongoose/" style="font-size:15px">mongoose</a> <a href="/tags/%E6%8A%A5%E9%94%99/" style="font-size:15px">报错</a> <a href="/tags/React/" style="font-size:15px">React</a> <a href="/tags/nextTick/" style="font-size:15px">nextTick</a> <a href="/tags/hooks/" style="font-size:15px">hooks</a> <a href="/tags/Menu/" style="font-size:15px">Menu</a> <a href="/tags/%E9%80%82%E9%85%8D/" style="font-size:15px">适配</a> <a href="/tags/Retina/" style="font-size:15px">Retina</a> <a href="/tags/Vim/" style="font-size:15px">Vim</a> <a href="/tags/Vite/" style="font-size:15px">Vite</a> <a href="/tags/Vue/" style="font-size:15px">Vue</a> <a href="/tags/%E6%89%8B%E6%92%95%E6%BA%90%E7%A0%81/" style="font-size:15px">手撕源码</a> <a href="/tags/Vue3/" style="font-size:15px">Vue3</a> <a href="/tags/websocket/" style="font-size:15px">websocket</a> <a href="/tags/vue-router/" style="font-size:15px">vue-router</a> <a href="/tags/vuex/" style="font-size:15px">vuex</a> <a href="/tags/mysql/" style="font-size:15px">mysql</a> <a href="/tags/navicat/" style="font-size:15px">navicat</a> <a href="/tags/iOS/" style="font-size:15px">iOS</a> <a href="/tags/iTerm2/" style="font-size:15px">iTerm2</a> <a href="/tags/%E9%94%AE%E7%9B%98/" style="font-size:15px">键盘</a> <a href="/tags/this/" style="font-size:15px">this</a> <a href="/tags/vscode/" style="font-size:15px">vscode</a> <a href="/tags/webpack/" style="font-size:15px">webpack</a> <a href="/tags/host/" style="font-size:15px">host</a> <a href="/tags/MongoDB/" style="font-size:15px">MongoDB</a> <a href="/tags/android%E6%A8%A1%E6%8B%9F%E5%99%A8/" style="font-size:15px">android模拟器</a> <a href="/tags/webview/" style="font-size:15px">webview</a> <a href="/tags/%E5%BE%AE%E4%BF%A1/" style="font-size:15px">微信</a> <a href="/tags/translate3d/" style="font-size:15px">translate3d</a> <a href="/tags/%E7%A7%BB%E5%8A%A8%E7%AB%AF%E9%80%82%E9%85%8D/" style="font-size:15px">移动端适配</a> <a href="/tags/%E7%BF%BB%E8%AF%91/" style="font-size:15px">翻译</a> <a href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" style="font-size:15px">设计模式</a></div></div><div class="widget"><div class="widget-title"> <i class="fa fa-file-o">最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2021/04/13/Vue2%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/">Vue2源码解析</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/04/08/AntV-L7%E4%B8%AD%E7%94%BB%E4%B8%80%E4%B8%AA%E6%8C%87%E5%AE%9A%E8%B7%9D%E7%A6%BB%E7%9A%84%E5%9C%86/">AntV-L7中画一个指定距离的圆</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/04/07/%E6%89%8B%E5%86%99Vue/">手写Vue</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/04/01/Vue%E5%85%A8%E5%AE%B6%E6%A1%B6&%E5%8E%9F%E7%90%86/">Vue全家桶&原理</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/03/30/Vite2%E5%B7%A5%E7%A8%8B%E5%8C%96/">Vite2工程化</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/03/29/React%E4%B8%AD%E7%9A%84nextTick/">React中的nextTick</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/03/29/Vue%E5%92%8CReact%E6%AF%94%E8%BE%83/">Vue和React设计思路</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/03/27/%E8%AE%BE%E7%BD%AEiTerm2%E5%85%8D%E5%AF%86%E7%99%BB%E9%99%86ssh%E8%BF%9C%E7%A8%8B%E6%9C%8D%E5%8A%A1%E5%99%A8/">设置iTerm2免密登陆ssh远程服务器</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/03/25/React%E9%80%92%E5%BD%92%E6%B8%B2%E6%9F%93AntD%E8%8F%9C%E5%8D%95/">React递归渲染AntD菜单</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/03/16/hexo%E4%B8%AD%E5%9B%BE%E7%89%87%E7%BB%84%E4%BB%B6hexo-asset-image%E7%9A%84%E4%BD%BF%E7%94%A8/">hexo中图片组件hexo-asset-image的使用</a></li></ul></div><div class="widget"><div class="widget-title"> <i class="fa fa-external-link">友情链接</i></div></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2021 <a href="/." rel="nofollow">大枫.</a> <a rel="nofollow" target="_blank" href="https://hexo.io">驱动 Hexo.</a> <a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo">主题 maupassant.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=1.0.0" async></script><script type="text/javascript" src="//cdn.jsdelivr.net/gh/fancyapps/fancybox/dist/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=1.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox/dist/jquery.fancybox.min.css"><script type="text/javascript" src="/js/copycode.js" successtext="复制成功!"></script><link rel="stylesheet" type="text/css" href="/css/copycode.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=1.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=1.0.0"></script></div></body></html>